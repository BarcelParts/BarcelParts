{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.FindOneAndUpdateOperation = exports.FindOneAndReplaceOperation = exports.FindOneAndDeleteOperation = exports.ReturnDocument = void 0;\n\nconst error_1 = require(\"../error\");\n\nconst read_preference_1 = require(\"../read_preference\");\n\nconst sort_1 = require(\"../sort\");\n\nconst utils_1 = require(\"../utils\");\n\nconst command_1 = require(\"./command\");\n\nconst operation_1 = require(\"./operation\");\n/** @public */\n\n\nexports.ReturnDocument = Object.freeze({\n  BEFORE: 'before',\n  AFTER: 'after'\n});\n\nfunction configureFindAndModifyCmdBaseUpdateOpts(cmdBase, options) {\n  cmdBase.new = options.returnDocument === exports.ReturnDocument.AFTER;\n  cmdBase.upsert = options.upsert === true;\n\n  if (options.bypassDocumentValidation === true) {\n    cmdBase.bypassDocumentValidation = options.bypassDocumentValidation;\n  }\n\n  return cmdBase;\n}\n/** @internal */\n\n\nclass FindAndModifyOperation extends command_1.CommandOperation {\n  constructor(collection, query, options) {\n    super(collection, options);\n    this.options = options !== null && options !== void 0 ? options : {};\n    this.cmdBase = {\n      remove: false,\n      new: false,\n      upsert: false\n    };\n    const sort = (0, sort_1.formatSort)(options.sort);\n\n    if (sort) {\n      this.cmdBase.sort = sort;\n    }\n\n    if (options.projection) {\n      this.cmdBase.fields = options.projection;\n    }\n\n    if (options.maxTimeMS) {\n      this.cmdBase.maxTimeMS = options.maxTimeMS;\n    } // Decorate the findAndModify command with the write Concern\n\n\n    if (options.writeConcern) {\n      this.cmdBase.writeConcern = options.writeConcern;\n    }\n\n    if (options.let) {\n      this.cmdBase.let = options.let;\n    } // we check for undefined specifically here to allow falsy values\n    // eslint-disable-next-line no-restricted-syntax\n\n\n    if (options.comment !== undefined) {\n      this.cmdBase.comment = options.comment;\n    } // force primary read preference\n\n\n    this.readPreference = read_preference_1.ReadPreference.primary;\n    this.collection = collection;\n    this.query = query;\n  }\n\n  execute(server, session, callback) {\n    var _a;\n\n    const coll = this.collection;\n    const query = this.query;\n    const options = { ...this.options,\n      ...this.bsonOptions\n    }; // Create findAndModify command object\n\n    const cmd = {\n      findAndModify: coll.collectionName,\n      query: query,\n      ...this.cmdBase\n    }; // Have we specified collation\n\n    try {\n      (0, utils_1.decorateWithCollation)(cmd, coll, options);\n    } catch (err) {\n      return callback(err);\n    }\n\n    if (options.hint) {\n      // TODO: once this method becomes a CommandOperation we will have the server\n      // in place to check.\n      const unacknowledgedWrite = ((_a = this.writeConcern) === null || _a === void 0 ? void 0 : _a.w) === 0;\n\n      if (unacknowledgedWrite || (0, utils_1.maxWireVersion)(server) < 8) {\n        callback(new error_1.MongoCompatibilityError('The current topology does not support a hint on findAndModify commands'));\n        return;\n      }\n\n      cmd.hint = options.hint;\n    }\n\n    if (this.explain && (0, utils_1.maxWireVersion)(server) < 4) {\n      callback(new error_1.MongoCompatibilityError(`Server ${server.name} does not support explain on findAndModify`));\n      return;\n    } // Execute the command\n\n\n    super.executeCommand(server, session, cmd, (err, result) => {\n      if (err) return callback(err);\n      return callback(undefined, result);\n    });\n  }\n\n}\n/** @internal */\n\n\nclass FindOneAndDeleteOperation extends FindAndModifyOperation {\n  constructor(collection, filter, options) {\n    // Basic validation\n    if (filter == null || typeof filter !== 'object') {\n      throw new error_1.MongoInvalidArgumentError('Argument \"filter\" must be an object');\n    }\n\n    super(collection, filter, options);\n    this.cmdBase.remove = true;\n  }\n\n}\n\nexports.FindOneAndDeleteOperation = FindOneAndDeleteOperation;\n/** @internal */\n\nclass FindOneAndReplaceOperation extends FindAndModifyOperation {\n  constructor(collection, filter, replacement, options) {\n    if (filter == null || typeof filter !== 'object') {\n      throw new error_1.MongoInvalidArgumentError('Argument \"filter\" must be an object');\n    }\n\n    if (replacement == null || typeof replacement !== 'object') {\n      throw new error_1.MongoInvalidArgumentError('Argument \"replacement\" must be an object');\n    }\n\n    if ((0, utils_1.hasAtomicOperators)(replacement)) {\n      throw new error_1.MongoInvalidArgumentError('Replacement document must not contain atomic operators');\n    }\n\n    super(collection, filter, options);\n    this.cmdBase.update = replacement;\n    configureFindAndModifyCmdBaseUpdateOpts(this.cmdBase, options);\n  }\n\n}\n\nexports.FindOneAndReplaceOperation = FindOneAndReplaceOperation;\n/** @internal */\n\nclass FindOneAndUpdateOperation extends FindAndModifyOperation {\n  constructor(collection, filter, update, options) {\n    if (filter == null || typeof filter !== 'object') {\n      throw new error_1.MongoInvalidArgumentError('Argument \"filter\" must be an object');\n    }\n\n    if (update == null || typeof update !== 'object') {\n      throw new error_1.MongoInvalidArgumentError('Argument \"update\" must be an object');\n    }\n\n    if (!(0, utils_1.hasAtomicOperators)(update)) {\n      throw new error_1.MongoInvalidArgumentError('Update document requires atomic operators');\n    }\n\n    super(collection, filter, options);\n    this.cmdBase.update = update;\n    configureFindAndModifyCmdBaseUpdateOpts(this.cmdBase, options);\n\n    if (options.arrayFilters) {\n      this.cmdBase.arrayFilters = options.arrayFilters;\n    }\n  }\n\n}\n\nexports.FindOneAndUpdateOperation = FindOneAndUpdateOperation;\n(0, operation_1.defineAspects)(FindAndModifyOperation, [operation_1.Aspect.WRITE_OPERATION, operation_1.Aspect.RETRYABLE, operation_1.Aspect.EXPLAINABLE]);","map":{"version":3,"mappings":"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","names":["exports","Object","freeze","BEFORE","AFTER","configureFindAndModifyCmdBaseUpdateOpts","cmdBase","options","new","returnDocument","upsert","bypassDocumentValidation","FindAndModifyOperation","command_1","constructor","collection","query","remove","sort","projection","fields","maxTimeMS","writeConcern","let","comment","undefined","readPreference","read_preference_1","primary","execute","server","session","callback","coll","bsonOptions","cmd","findAndModify","collectionName","err","hint","unacknowledgedWrite","_a","w","error_1","explain","name","executeCommand","result","FindOneAndDeleteOperation","filter","FindOneAndReplaceOperation","replacement","update","FindOneAndUpdateOperation","arrayFilters","operation_1","WRITE_OPERATION","RETRYABLE","EXPLAINABLE"],"sources":["D:\\Barcelparts\\node_modules\\mongodb\\src\\operations\\find_and_modify.ts"],"sourcesContent":["import type { Document } from '../bson';\nimport type { Collection } from '../collection';\nimport { MongoCompatibilityError, MongoInvalidArgumentError } from '../error';\nimport { ReadPreference } from '../read_preference';\nimport type { Server } from '../sdam/server';\nimport type { ClientSession } from '../sessions';\nimport { formatSort, Sort, SortForCmd } from '../sort';\nimport { Callback, decorateWithCollation, hasAtomicOperators, maxWireVersion } from '../utils';\nimport type { WriteConcern, WriteConcernSettings } from '../write_concern';\nimport { CommandOperation, CommandOperationOptions } from './command';\nimport { Aspect, defineAspects } from './operation';\n\n/** @public */\nexport const ReturnDocument = Object.freeze({\n  BEFORE: 'before',\n  AFTER: 'after'\n} as const);\n\n/** @public */\nexport type ReturnDocument = typeof ReturnDocument[keyof typeof ReturnDocument];\n\n/** @public */\nexport interface FindOneAndDeleteOptions extends CommandOperationOptions {\n  /** An optional hint for query optimization. See the {@link https://docs.mongodb.com/manual/reference/command/update/#update-command-hint|update command} reference for more information.*/\n  hint?: Document;\n  /** Limits the fields to return for all matching documents. */\n  projection?: Document;\n  /** Determines which document the operation modifies if the query selects multiple documents. */\n  sort?: Sort;\n  /** Map of parameter names and values that can be accessed using $$var (requires MongoDB 5.0). */\n  let?: Document;\n}\n\n/** @public */\nexport interface FindOneAndReplaceOptions extends CommandOperationOptions {\n  /** Allow driver to bypass schema validation in MongoDB 3.2 or higher. */\n  bypassDocumentValidation?: boolean;\n  /** An optional hint for query optimization. See the {@link https://docs.mongodb.com/manual/reference/command/update/#update-command-hint|update command} reference for more information.*/\n  hint?: Document;\n  /** Limits the fields to return for all matching documents. */\n  projection?: Document;\n  /** When set to 'after', returns the updated document rather than the original. The default is 'before'.  */\n  returnDocument?: ReturnDocument;\n  /** Determines which document the operation modifies if the query selects multiple documents. */\n  sort?: Sort;\n  /** Upsert the document if it does not exist. */\n  upsert?: boolean;\n  /** Map of parameter names and values that can be accessed using $$var (requires MongoDB 5.0). */\n  let?: Document;\n}\n\n/** @public */\nexport interface FindOneAndUpdateOptions extends CommandOperationOptions {\n  /** Optional list of array filters referenced in filtered positional operators */\n  arrayFilters?: Document[];\n  /** Allow driver to bypass schema validation in MongoDB 3.2 or higher. */\n  bypassDocumentValidation?: boolean;\n  /** An optional hint for query optimization. See the {@link https://docs.mongodb.com/manual/reference/command/update/#update-command-hint|update command} reference for more information.*/\n  hint?: Document;\n  /** Limits the fields to return for all matching documents. */\n  projection?: Document;\n  /** When set to 'after', returns the updated document rather than the original. The default is 'before'.  */\n  returnDocument?: ReturnDocument;\n  /** Determines which document the operation modifies if the query selects multiple documents. */\n  sort?: Sort;\n  /** Upsert the document if it does not exist. */\n  upsert?: boolean;\n  /** Map of parameter names and values that can be accessed using $$var (requires MongoDB 5.0). */\n  let?: Document;\n}\n\n/** @internal */\ninterface FindAndModifyCmdBase {\n  remove: boolean;\n  new: boolean;\n  upsert: boolean;\n  update?: Document;\n  sort?: SortForCmd;\n  fields?: Document;\n  bypassDocumentValidation?: boolean;\n  arrayFilters?: Document[];\n  maxTimeMS?: number;\n  let?: Document;\n  writeConcern?: WriteConcern | WriteConcernSettings;\n  /**\n   * Comment to apply to the operation.\n   *\n   * In server versions pre-4.4, 'comment' must be string.  A server\n   * error will be thrown if any other type is provided.\n   *\n   * In server versions 4.4 and above, 'comment' can be any valid BSON type.\n   */\n  comment?: unknown;\n}\n\nfunction configureFindAndModifyCmdBaseUpdateOpts(\n  cmdBase: FindAndModifyCmdBase,\n  options: FindOneAndReplaceOptions | FindOneAndUpdateOptions\n): FindAndModifyCmdBase {\n  cmdBase.new = options.returnDocument === ReturnDocument.AFTER;\n  cmdBase.upsert = options.upsert === true;\n\n  if (options.bypassDocumentValidation === true) {\n    cmdBase.bypassDocumentValidation = options.bypassDocumentValidation;\n  }\n  return cmdBase;\n}\n\n/** @internal */\nclass FindAndModifyOperation extends CommandOperation<Document> {\n  override options: FindOneAndReplaceOptions | FindOneAndUpdateOptions | FindOneAndDeleteOptions;\n  cmdBase: FindAndModifyCmdBase;\n  collection: Collection;\n  query: Document;\n  doc?: Document;\n\n  constructor(\n    collection: Collection,\n    query: Document,\n    options: FindOneAndReplaceOptions | FindOneAndUpdateOptions | FindOneAndDeleteOptions\n  ) {\n    super(collection, options);\n    this.options = options ?? {};\n    this.cmdBase = {\n      remove: false,\n      new: false,\n      upsert: false\n    };\n\n    const sort = formatSort(options.sort);\n    if (sort) {\n      this.cmdBase.sort = sort;\n    }\n\n    if (options.projection) {\n      this.cmdBase.fields = options.projection;\n    }\n\n    if (options.maxTimeMS) {\n      this.cmdBase.maxTimeMS = options.maxTimeMS;\n    }\n\n    // Decorate the findAndModify command with the write Concern\n    if (options.writeConcern) {\n      this.cmdBase.writeConcern = options.writeConcern;\n    }\n\n    if (options.let) {\n      this.cmdBase.let = options.let;\n    }\n\n    // we check for undefined specifically here to allow falsy values\n    // eslint-disable-next-line no-restricted-syntax\n    if (options.comment !== undefined) {\n      this.cmdBase.comment = options.comment;\n    }\n\n    // force primary read preference\n    this.readPreference = ReadPreference.primary;\n\n    this.collection = collection;\n    this.query = query;\n  }\n\n  override execute(\n    server: Server,\n    session: ClientSession | undefined,\n    callback: Callback<Document>\n  ): void {\n    const coll = this.collection;\n    const query = this.query;\n    const options = { ...this.options, ...this.bsonOptions };\n\n    // Create findAndModify command object\n    const cmd: Document = {\n      findAndModify: coll.collectionName,\n      query: query,\n      ...this.cmdBase\n    };\n\n    // Have we specified collation\n    try {\n      decorateWithCollation(cmd, coll, options);\n    } catch (err) {\n      return callback(err);\n    }\n\n    if (options.hint) {\n      // TODO: once this method becomes a CommandOperation we will have the server\n      // in place to check.\n      const unacknowledgedWrite = this.writeConcern?.w === 0;\n      if (unacknowledgedWrite || maxWireVersion(server) < 8) {\n        callback(\n          new MongoCompatibilityError(\n            'The current topology does not support a hint on findAndModify commands'\n          )\n        );\n\n        return;\n      }\n\n      cmd.hint = options.hint;\n    }\n\n    if (this.explain && maxWireVersion(server) < 4) {\n      callback(\n        new MongoCompatibilityError(\n          `Server ${server.name} does not support explain on findAndModify`\n        )\n      );\n      return;\n    }\n\n    // Execute the command\n    super.executeCommand(server, session, cmd, (err, result) => {\n      if (err) return callback(err);\n      return callback(undefined, result);\n    });\n  }\n}\n\n/** @internal */\nexport class FindOneAndDeleteOperation extends FindAndModifyOperation {\n  constructor(collection: Collection, filter: Document, options: FindOneAndDeleteOptions) {\n    // Basic validation\n    if (filter == null || typeof filter !== 'object') {\n      throw new MongoInvalidArgumentError('Argument \"filter\" must be an object');\n    }\n\n    super(collection, filter, options);\n    this.cmdBase.remove = true;\n  }\n}\n\n/** @internal */\nexport class FindOneAndReplaceOperation extends FindAndModifyOperation {\n  constructor(\n    collection: Collection,\n    filter: Document,\n    replacement: Document,\n    options: FindOneAndReplaceOptions\n  ) {\n    if (filter == null || typeof filter !== 'object') {\n      throw new MongoInvalidArgumentError('Argument \"filter\" must be an object');\n    }\n\n    if (replacement == null || typeof replacement !== 'object') {\n      throw new MongoInvalidArgumentError('Argument \"replacement\" must be an object');\n    }\n\n    if (hasAtomicOperators(replacement)) {\n      throw new MongoInvalidArgumentError('Replacement document must not contain atomic operators');\n    }\n\n    super(collection, filter, options);\n    this.cmdBase.update = replacement;\n    configureFindAndModifyCmdBaseUpdateOpts(this.cmdBase, options);\n  }\n}\n\n/** @internal */\nexport class FindOneAndUpdateOperation extends FindAndModifyOperation {\n  constructor(\n    collection: Collection,\n    filter: Document,\n    update: Document,\n    options: FindOneAndUpdateOptions\n  ) {\n    if (filter == null || typeof filter !== 'object') {\n      throw new MongoInvalidArgumentError('Argument \"filter\" must be an object');\n    }\n\n    if (update == null || typeof update !== 'object') {\n      throw new MongoInvalidArgumentError('Argument \"update\" must be an object');\n    }\n\n    if (!hasAtomicOperators(update)) {\n      throw new MongoInvalidArgumentError('Update document requires atomic operators');\n    }\n\n    super(collection, filter, options);\n    this.cmdBase.update = update;\n    configureFindAndModifyCmdBaseUpdateOpts(this.cmdBase, options);\n\n    if (options.arrayFilters) {\n      this.cmdBase.arrayFilters = options.arrayFilters;\n    }\n  }\n}\n\ndefineAspects(FindAndModifyOperation, [\n  Aspect.WRITE_OPERATION,\n  Aspect.RETRYABLE,\n  Aspect.EXPLAINABLE\n]);\n"]},"metadata":{},"sourceType":"script"}