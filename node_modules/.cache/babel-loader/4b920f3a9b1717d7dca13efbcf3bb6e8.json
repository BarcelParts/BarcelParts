{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ReceiveBuffer = void 0;\n\nclass ReceiveBuffer {\n  constructor() {\n    let size = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 4096;\n    this.buffer = Buffer.allocUnsafe(size);\n    this.offset = 0;\n    this.originalSize = size;\n  }\n\n  get length() {\n    return this.offset;\n  }\n\n  append(data) {\n    if (!Buffer.isBuffer(data)) {\n      throw new Error('Attempted to append a non-buffer instance to ReceiveBuffer.');\n    }\n\n    if (this.offset + data.length >= this.buffer.length) {\n      const tmp = this.buffer;\n      this.buffer = Buffer.allocUnsafe(Math.max(this.buffer.length + this.originalSize, this.buffer.length + data.length));\n      tmp.copy(this.buffer);\n    }\n\n    data.copy(this.buffer, this.offset);\n    return this.offset += data.length;\n  }\n\n  peek(length) {\n    if (length > this.offset) {\n      throw new Error('Attempted to read beyond the bounds of the managed internal data.');\n    }\n\n    return this.buffer.slice(0, length);\n  }\n\n  get(length) {\n    if (length > this.offset) {\n      throw new Error('Attempted to read beyond the bounds of the managed internal data.');\n    }\n\n    const value = Buffer.allocUnsafe(length);\n    this.buffer.slice(0, length).copy(value);\n    this.buffer.copyWithin(0, length, length + this.offset - length);\n    this.offset -= length;\n    return value;\n  }\n\n}\n\nexports.ReceiveBuffer = ReceiveBuffer;","map":{"version":3,"mappings":";;;;;;;AAAA,MAAMA,aAAN,CAAmB;AAKjBC,gBAA+B;AAAA,QAAnBC,IAAmB,uEAAJ,IAAI;AAC7B,SAAKC,MAAL,GAAcC,MAAM,CAACC,WAAP,CAAmBH,IAAnB,CAAd;AACA,SAAKI,MAAL,GAAc,CAAd;AACA,SAAKC,YAAL,GAAoBL,IAApB;AACD;;AAES,MAANM,MAAM;AACR,WAAO,KAAKF,MAAZ;AACD;;AAEDG,QAAM,CAACC,IAAD,EAAa;AACjB,QAAI,CAACN,MAAM,CAACO,QAAP,CAAgBD,IAAhB,CAAL,EAA4B;AAC1B,YAAM,IAAIE,KAAJ,CACJ,6DADI,CAAN;AAGD;;AAED,QAAI,KAAKN,MAAL,GAAcI,IAAI,CAACF,MAAnB,IAA6B,KAAKL,MAAL,CAAYK,MAA7C,EAAqD;AACnD,YAAMK,GAAG,GAAG,KAAKV,MAAjB;AACA,WAAKA,MAAL,GAAcC,MAAM,CAACC,WAAP,CACZS,IAAI,CAACC,GAAL,CACE,KAAKZ,MAAL,CAAYK,MAAZ,GAAqB,KAAKD,YAD5B,EAEE,KAAKJ,MAAL,CAAYK,MAAZ,GAAqBE,IAAI,CAACF,MAF5B,CADY,CAAd;AAMAK,SAAG,CAACG,IAAJ,CAAS,KAAKb,MAAd;AACD;;AAEDO,QAAI,CAACM,IAAL,CAAU,KAAKb,MAAf,EAAuB,KAAKG,MAA5B;AACA,WAAQ,KAAKA,MAAL,IAAeI,IAAI,CAACF,MAA5B;AACD;;AAEDS,MAAI,CAACT,MAAD,EAAe;AACjB,QAAIA,MAAM,GAAG,KAAKF,MAAlB,EAA0B;AACxB,YAAM,IAAIM,KAAJ,CACJ,mEADI,CAAN;AAGD;;AACD,WAAO,KAAKT,MAAL,CAAYe,KAAZ,CAAkB,CAAlB,EAAqBV,MAArB,CAAP;AACD;;AAEDW,KAAG,CAACX,MAAD,EAAe;AAChB,QAAIA,MAAM,GAAG,KAAKF,MAAlB,EAA0B;AACxB,YAAM,IAAIM,KAAJ,CACJ,mEADI,CAAN;AAGD;;AAED,UAAMQ,KAAK,GAAGhB,MAAM,CAACC,WAAP,CAAmBG,MAAnB,CAAd;AACA,SAAKL,MAAL,CAAYe,KAAZ,CAAkB,CAAlB,EAAqBV,MAArB,EAA6BQ,IAA7B,CAAkCI,KAAlC;AACA,SAAKjB,MAAL,CAAYkB,UAAZ,CAAuB,CAAvB,EAA0Bb,MAA1B,EAAkCA,MAAM,GAAG,KAAKF,MAAd,GAAuBE,MAAzD;AACA,SAAKF,MAAL,IAAeE,MAAf;AAEA,WAAOY,KAAP;AACD;;AA3DgB;;AA8DXE","names":["ReceiveBuffer","constructor","size","buffer","Buffer","allocUnsafe","offset","originalSize","length","append","data","isBuffer","Error","tmp","Math","max","copy","peek","slice","get","value","copyWithin","exports"],"sources":["../../src/common/receivebuffer.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}