{"ast":null,"code":"\"use strict\";\n\nconst tr46 = require(\"tr46\");\n\nconst infra = require(\"./infra\");\n\nconst {\n  utf8DecodeWithoutBOM\n} = require(\"./encoding\");\n\nconst {\n  percentDecodeString,\n  utf8PercentEncodeCodePoint,\n  utf8PercentEncodeString,\n  isC0ControlPercentEncode,\n  isFragmentPercentEncode,\n  isQueryPercentEncode,\n  isSpecialQueryPercentEncode,\n  isPathPercentEncode,\n  isUserinfoPercentEncode\n} = require(\"./percent-encoding\");\n\nfunction p(char) {\n  return char.codePointAt(0);\n}\n\nconst specialSchemes = {\n  ftp: 21,\n  file: null,\n  http: 80,\n  https: 443,\n  ws: 80,\n  wss: 443\n};\nconst failure = Symbol(\"failure\");\n\nfunction countSymbols(str) {\n  return [...str].length;\n}\n\nfunction at(input, idx) {\n  const c = input[idx];\n  return isNaN(c) ? undefined : String.fromCodePoint(c);\n}\n\nfunction isSingleDot(buffer) {\n  return buffer === \".\" || buffer.toLowerCase() === \"%2e\";\n}\n\nfunction isDoubleDot(buffer) {\n  buffer = buffer.toLowerCase();\n  return buffer === \"..\" || buffer === \"%2e.\" || buffer === \".%2e\" || buffer === \"%2e%2e\";\n}\n\nfunction isWindowsDriveLetterCodePoints(cp1, cp2) {\n  return infra.isASCIIAlpha(cp1) && (cp2 === p(\":\") || cp2 === p(\"|\"));\n}\n\nfunction isWindowsDriveLetterString(string) {\n  return string.length === 2 && infra.isASCIIAlpha(string.codePointAt(0)) && (string[1] === \":\" || string[1] === \"|\");\n}\n\nfunction isNormalizedWindowsDriveLetterString(string) {\n  return string.length === 2 && infra.isASCIIAlpha(string.codePointAt(0)) && string[1] === \":\";\n}\n\nfunction containsForbiddenHostCodePoint(string) {\n  return string.search(/\\u0000|\\u0009|\\u000A|\\u000D|\\u0020|#|%|\\/|:|<|>|\\?|@|\\[|\\\\|\\]|\\^|\\|/u) !== -1;\n}\n\nfunction containsForbiddenHostCodePointExcludingPercent(string) {\n  return string.search(/\\u0000|\\u0009|\\u000A|\\u000D|\\u0020|#|\\/|:|<|>|\\?|@|\\[|\\\\|\\]|\\^|\\|/u) !== -1;\n}\n\nfunction isSpecialScheme(scheme) {\n  return specialSchemes[scheme] !== undefined;\n}\n\nfunction isSpecial(url) {\n  return isSpecialScheme(url.scheme);\n}\n\nfunction isNotSpecial(url) {\n  return !isSpecialScheme(url.scheme);\n}\n\nfunction defaultPort(scheme) {\n  return specialSchemes[scheme];\n}\n\nfunction parseIPv4Number(input) {\n  if (input === \"\") {\n    return failure;\n  }\n\n  let R = 10;\n\n  if (input.length >= 2 && input.charAt(0) === \"0\" && input.charAt(1).toLowerCase() === \"x\") {\n    input = input.substring(2);\n    R = 16;\n  } else if (input.length >= 2 && input.charAt(0) === \"0\") {\n    input = input.substring(1);\n    R = 8;\n  }\n\n  if (input === \"\") {\n    return 0;\n  }\n\n  let regex = /[^0-7]/u;\n\n  if (R === 10) {\n    regex = /[^0-9]/u;\n  }\n\n  if (R === 16) {\n    regex = /[^0-9A-Fa-f]/u;\n  }\n\n  if (regex.test(input)) {\n    return failure;\n  }\n\n  return parseInt(input, R);\n}\n\nfunction parseIPv4(input) {\n  const parts = input.split(\".\");\n\n  if (parts[parts.length - 1] === \"\") {\n    if (parts.length > 1) {\n      parts.pop();\n    }\n  }\n\n  if (parts.length > 4) {\n    return failure;\n  }\n\n  const numbers = [];\n\n  for (const part of parts) {\n    const n = parseIPv4Number(part);\n\n    if (n === failure) {\n      return failure;\n    }\n\n    numbers.push(n);\n  }\n\n  for (let i = 0; i < numbers.length - 1; ++i) {\n    if (numbers[i] > 255) {\n      return failure;\n    }\n  }\n\n  if (numbers[numbers.length - 1] >= 256 ** (5 - numbers.length)) {\n    return failure;\n  }\n\n  let ipv4 = numbers.pop();\n  let counter = 0;\n\n  for (const n of numbers) {\n    ipv4 += n * 256 ** (3 - counter);\n    ++counter;\n  }\n\n  return ipv4;\n}\n\nfunction serializeIPv4(address) {\n  let output = \"\";\n  let n = address;\n\n  for (let i = 1; i <= 4; ++i) {\n    output = String(n % 256) + output;\n\n    if (i !== 4) {\n      output = `.${output}`;\n    }\n\n    n = Math.floor(n / 256);\n  }\n\n  return output;\n}\n\nfunction parseIPv6(input) {\n  const address = [0, 0, 0, 0, 0, 0, 0, 0];\n  let pieceIndex = 0;\n  let compress = null;\n  let pointer = 0;\n  input = Array.from(input, c => c.codePointAt(0));\n\n  if (input[pointer] === p(\":\")) {\n    if (input[pointer + 1] !== p(\":\")) {\n      return failure;\n    }\n\n    pointer += 2;\n    ++pieceIndex;\n    compress = pieceIndex;\n  }\n\n  while (pointer < input.length) {\n    if (pieceIndex === 8) {\n      return failure;\n    }\n\n    if (input[pointer] === p(\":\")) {\n      if (compress !== null) {\n        return failure;\n      }\n\n      ++pointer;\n      ++pieceIndex;\n      compress = pieceIndex;\n      continue;\n    }\n\n    let value = 0;\n    let length = 0;\n\n    while (length < 4 && infra.isASCIIHex(input[pointer])) {\n      value = value * 0x10 + parseInt(at(input, pointer), 16);\n      ++pointer;\n      ++length;\n    }\n\n    if (input[pointer] === p(\".\")) {\n      if (length === 0) {\n        return failure;\n      }\n\n      pointer -= length;\n\n      if (pieceIndex > 6) {\n        return failure;\n      }\n\n      let numbersSeen = 0;\n\n      while (input[pointer] !== undefined) {\n        let ipv4Piece = null;\n\n        if (numbersSeen > 0) {\n          if (input[pointer] === p(\".\") && numbersSeen < 4) {\n            ++pointer;\n          } else {\n            return failure;\n          }\n        }\n\n        if (!infra.isASCIIDigit(input[pointer])) {\n          return failure;\n        }\n\n        while (infra.isASCIIDigit(input[pointer])) {\n          const number = parseInt(at(input, pointer));\n\n          if (ipv4Piece === null) {\n            ipv4Piece = number;\n          } else if (ipv4Piece === 0) {\n            return failure;\n          } else {\n            ipv4Piece = ipv4Piece * 10 + number;\n          }\n\n          if (ipv4Piece > 255) {\n            return failure;\n          }\n\n          ++pointer;\n        }\n\n        address[pieceIndex] = address[pieceIndex] * 0x100 + ipv4Piece;\n        ++numbersSeen;\n\n        if (numbersSeen === 2 || numbersSeen === 4) {\n          ++pieceIndex;\n        }\n      }\n\n      if (numbersSeen !== 4) {\n        return failure;\n      }\n\n      break;\n    } else if (input[pointer] === p(\":\")) {\n      ++pointer;\n\n      if (input[pointer] === undefined) {\n        return failure;\n      }\n    } else if (input[pointer] !== undefined) {\n      return failure;\n    }\n\n    address[pieceIndex] = value;\n    ++pieceIndex;\n  }\n\n  if (compress !== null) {\n    let swaps = pieceIndex - compress;\n    pieceIndex = 7;\n\n    while (pieceIndex !== 0 && swaps > 0) {\n      const temp = address[compress + swaps - 1];\n      address[compress + swaps - 1] = address[pieceIndex];\n      address[pieceIndex] = temp;\n      --pieceIndex;\n      --swaps;\n    }\n  } else if (compress === null && pieceIndex !== 8) {\n    return failure;\n  }\n\n  return address;\n}\n\nfunction serializeIPv6(address) {\n  let output = \"\";\n  const compress = findLongestZeroSequence(address);\n  let ignore0 = false;\n\n  for (let pieceIndex = 0; pieceIndex <= 7; ++pieceIndex) {\n    if (ignore0 && address[pieceIndex] === 0) {\n      continue;\n    } else if (ignore0) {\n      ignore0 = false;\n    }\n\n    if (compress === pieceIndex) {\n      const separator = pieceIndex === 0 ? \"::\" : \":\";\n      output += separator;\n      ignore0 = true;\n      continue;\n    }\n\n    output += address[pieceIndex].toString(16);\n\n    if (pieceIndex !== 7) {\n      output += \":\";\n    }\n  }\n\n  return output;\n}\n\nfunction parseHost(input) {\n  let isNotSpecialArg = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n  if (input[0] === \"[\") {\n    if (input[input.length - 1] !== \"]\") {\n      return failure;\n    }\n\n    return parseIPv6(input.substring(1, input.length - 1));\n  }\n\n  if (isNotSpecialArg) {\n    return parseOpaqueHost(input);\n  }\n\n  const domain = utf8DecodeWithoutBOM(percentDecodeString(input));\n  const asciiDomain = domainToASCII(domain);\n\n  if (asciiDomain === failure) {\n    return failure;\n  }\n\n  if (containsForbiddenHostCodePoint(asciiDomain)) {\n    return failure;\n  }\n\n  if (endsInANumber(asciiDomain)) {\n    return parseIPv4(asciiDomain);\n  }\n\n  return asciiDomain;\n}\n\nfunction endsInANumber(input) {\n  const parts = input.split(\".\");\n\n  if (parts[parts.length - 1] === \"\") {\n    if (parts.length === 1) {\n      return false;\n    }\n\n    parts.pop();\n  }\n\n  const last = parts[parts.length - 1];\n\n  if (parseIPv4Number(last) !== failure) {\n    return true;\n  }\n\n  if (/^[0-9]+$/u.test(last)) {\n    return true;\n  }\n\n  return false;\n}\n\nfunction parseOpaqueHost(input) {\n  if (containsForbiddenHostCodePointExcludingPercent(input)) {\n    return failure;\n  }\n\n  return utf8PercentEncodeString(input, isC0ControlPercentEncode);\n}\n\nfunction findLongestZeroSequence(arr) {\n  let maxIdx = null;\n  let maxLen = 1; // only find elements > 1\n\n  let currStart = null;\n  let currLen = 0;\n\n  for (let i = 0; i < arr.length; ++i) {\n    if (arr[i] !== 0) {\n      if (currLen > maxLen) {\n        maxIdx = currStart;\n        maxLen = currLen;\n      }\n\n      currStart = null;\n      currLen = 0;\n    } else {\n      if (currStart === null) {\n        currStart = i;\n      }\n\n      ++currLen;\n    }\n  } // if trailing zeros\n\n\n  if (currLen > maxLen) {\n    return currStart;\n  }\n\n  return maxIdx;\n}\n\nfunction serializeHost(host) {\n  if (typeof host === \"number\") {\n    return serializeIPv4(host);\n  } // IPv6 serializer\n\n\n  if (host instanceof Array) {\n    return `[${serializeIPv6(host)}]`;\n  }\n\n  return host;\n}\n\nfunction domainToASCII(domain) {\n  let beStrict = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n  const result = tr46.toASCII(domain, {\n    checkBidi: true,\n    checkHyphens: false,\n    checkJoiners: true,\n    useSTD3ASCIIRules: beStrict,\n    verifyDNSLength: beStrict\n  });\n\n  if (result === null || result === \"\") {\n    return failure;\n  }\n\n  return result;\n}\n\nfunction trimControlChars(url) {\n  return url.replace(/^[\\u0000-\\u001F\\u0020]+|[\\u0000-\\u001F\\u0020]+$/ug, \"\");\n}\n\nfunction trimTabAndNewline(url) {\n  return url.replace(/\\u0009|\\u000A|\\u000D/ug, \"\");\n}\n\nfunction shortenPath(url) {\n  const {\n    path\n  } = url;\n\n  if (path.length === 0) {\n    return;\n  }\n\n  if (url.scheme === \"file\" && path.length === 1 && isNormalizedWindowsDriveLetter(path[0])) {\n    return;\n  }\n\n  path.pop();\n}\n\nfunction includesCredentials(url) {\n  return url.username !== \"\" || url.password !== \"\";\n}\n\nfunction cannotHaveAUsernamePasswordPort(url) {\n  return url.host === null || url.host === \"\" || hasAnOpaquePath(url) || url.scheme === \"file\";\n}\n\nfunction hasAnOpaquePath(url) {\n  return typeof url.path === \"string\";\n}\n\nfunction isNormalizedWindowsDriveLetter(string) {\n  return /^[A-Za-z]:$/u.test(string);\n}\n\nfunction URLStateMachine(input, base, encodingOverride, url, stateOverride) {\n  this.pointer = 0;\n  this.input = input;\n  this.base = base || null;\n  this.encodingOverride = encodingOverride || \"utf-8\";\n  this.stateOverride = stateOverride;\n  this.url = url;\n  this.failure = false;\n  this.parseError = false;\n\n  if (!this.url) {\n    this.url = {\n      scheme: \"\",\n      username: \"\",\n      password: \"\",\n      host: null,\n      port: null,\n      path: [],\n      query: null,\n      fragment: null\n    };\n    const res = trimControlChars(this.input);\n\n    if (res !== this.input) {\n      this.parseError = true;\n    }\n\n    this.input = res;\n  }\n\n  const res = trimTabAndNewline(this.input);\n\n  if (res !== this.input) {\n    this.parseError = true;\n  }\n\n  this.input = res;\n  this.state = stateOverride || \"scheme start\";\n  this.buffer = \"\";\n  this.atFlag = false;\n  this.arrFlag = false;\n  this.passwordTokenSeenFlag = false;\n  this.input = Array.from(this.input, c => c.codePointAt(0));\n\n  for (; this.pointer <= this.input.length; ++this.pointer) {\n    const c = this.input[this.pointer];\n    const cStr = isNaN(c) ? undefined : String.fromCodePoint(c); // exec state machine\n\n    const ret = this[`parse ${this.state}`](c, cStr);\n\n    if (!ret) {\n      break; // terminate algorithm\n    } else if (ret === failure) {\n      this.failure = true;\n      break;\n    }\n  }\n}\n\nURLStateMachine.prototype[\"parse scheme start\"] = function parseSchemeStart(c, cStr) {\n  if (infra.isASCIIAlpha(c)) {\n    this.buffer += cStr.toLowerCase();\n    this.state = \"scheme\";\n  } else if (!this.stateOverride) {\n    this.state = \"no scheme\";\n    --this.pointer;\n  } else {\n    this.parseError = true;\n    return failure;\n  }\n\n  return true;\n};\n\nURLStateMachine.prototype[\"parse scheme\"] = function parseScheme(c, cStr) {\n  if (infra.isASCIIAlphanumeric(c) || c === p(\"+\") || c === p(\"-\") || c === p(\".\")) {\n    this.buffer += cStr.toLowerCase();\n  } else if (c === p(\":\")) {\n    if (this.stateOverride) {\n      if (isSpecial(this.url) && !isSpecialScheme(this.buffer)) {\n        return false;\n      }\n\n      if (!isSpecial(this.url) && isSpecialScheme(this.buffer)) {\n        return false;\n      }\n\n      if ((includesCredentials(this.url) || this.url.port !== null) && this.buffer === \"file\") {\n        return false;\n      }\n\n      if (this.url.scheme === \"file\" && this.url.host === \"\") {\n        return false;\n      }\n    }\n\n    this.url.scheme = this.buffer;\n\n    if (this.stateOverride) {\n      if (this.url.port === defaultPort(this.url.scheme)) {\n        this.url.port = null;\n      }\n\n      return false;\n    }\n\n    this.buffer = \"\";\n\n    if (this.url.scheme === \"file\") {\n      if (this.input[this.pointer + 1] !== p(\"/\") || this.input[this.pointer + 2] !== p(\"/\")) {\n        this.parseError = true;\n      }\n\n      this.state = \"file\";\n    } else if (isSpecial(this.url) && this.base !== null && this.base.scheme === this.url.scheme) {\n      this.state = \"special relative or authority\";\n    } else if (isSpecial(this.url)) {\n      this.state = \"special authority slashes\";\n    } else if (this.input[this.pointer + 1] === p(\"/\")) {\n      this.state = \"path or authority\";\n      ++this.pointer;\n    } else {\n      this.url.path = \"\";\n      this.state = \"opaque path\";\n    }\n  } else if (!this.stateOverride) {\n    this.buffer = \"\";\n    this.state = \"no scheme\";\n    this.pointer = -1;\n  } else {\n    this.parseError = true;\n    return failure;\n  }\n\n  return true;\n};\n\nURLStateMachine.prototype[\"parse no scheme\"] = function parseNoScheme(c) {\n  if (this.base === null || hasAnOpaquePath(this.base) && c !== p(\"#\")) {\n    return failure;\n  } else if (hasAnOpaquePath(this.base) && c === p(\"#\")) {\n    this.url.scheme = this.base.scheme;\n    this.url.path = this.base.path;\n    this.url.query = this.base.query;\n    this.url.fragment = \"\";\n    this.state = \"fragment\";\n  } else if (this.base.scheme === \"file\") {\n    this.state = \"file\";\n    --this.pointer;\n  } else {\n    this.state = \"relative\";\n    --this.pointer;\n  }\n\n  return true;\n};\n\nURLStateMachine.prototype[\"parse special relative or authority\"] = function parseSpecialRelativeOrAuthority(c) {\n  if (c === p(\"/\") && this.input[this.pointer + 1] === p(\"/\")) {\n    this.state = \"special authority ignore slashes\";\n    ++this.pointer;\n  } else {\n    this.parseError = true;\n    this.state = \"relative\";\n    --this.pointer;\n  }\n\n  return true;\n};\n\nURLStateMachine.prototype[\"parse path or authority\"] = function parsePathOrAuthority(c) {\n  if (c === p(\"/\")) {\n    this.state = \"authority\";\n  } else {\n    this.state = \"path\";\n    --this.pointer;\n  }\n\n  return true;\n};\n\nURLStateMachine.prototype[\"parse relative\"] = function parseRelative(c) {\n  this.url.scheme = this.base.scheme;\n\n  if (c === p(\"/\")) {\n    this.state = \"relative slash\";\n  } else if (isSpecial(this.url) && c === p(\"\\\\\")) {\n    this.parseError = true;\n    this.state = \"relative slash\";\n  } else {\n    this.url.username = this.base.username;\n    this.url.password = this.base.password;\n    this.url.host = this.base.host;\n    this.url.port = this.base.port;\n    this.url.path = this.base.path.slice();\n    this.url.query = this.base.query;\n\n    if (c === p(\"?\")) {\n      this.url.query = \"\";\n      this.state = \"query\";\n    } else if (c === p(\"#\")) {\n      this.url.fragment = \"\";\n      this.state = \"fragment\";\n    } else if (!isNaN(c)) {\n      this.url.query = null;\n      this.url.path.pop();\n      this.state = \"path\";\n      --this.pointer;\n    }\n  }\n\n  return true;\n};\n\nURLStateMachine.prototype[\"parse relative slash\"] = function parseRelativeSlash(c) {\n  if (isSpecial(this.url) && (c === p(\"/\") || c === p(\"\\\\\"))) {\n    if (c === p(\"\\\\\")) {\n      this.parseError = true;\n    }\n\n    this.state = \"special authority ignore slashes\";\n  } else if (c === p(\"/\")) {\n    this.state = \"authority\";\n  } else {\n    this.url.username = this.base.username;\n    this.url.password = this.base.password;\n    this.url.host = this.base.host;\n    this.url.port = this.base.port;\n    this.state = \"path\";\n    --this.pointer;\n  }\n\n  return true;\n};\n\nURLStateMachine.prototype[\"parse special authority slashes\"] = function parseSpecialAuthoritySlashes(c) {\n  if (c === p(\"/\") && this.input[this.pointer + 1] === p(\"/\")) {\n    this.state = \"special authority ignore slashes\";\n    ++this.pointer;\n  } else {\n    this.parseError = true;\n    this.state = \"special authority ignore slashes\";\n    --this.pointer;\n  }\n\n  return true;\n};\n\nURLStateMachine.prototype[\"parse special authority ignore slashes\"] = function parseSpecialAuthorityIgnoreSlashes(c) {\n  if (c !== p(\"/\") && c !== p(\"\\\\\")) {\n    this.state = \"authority\";\n    --this.pointer;\n  } else {\n    this.parseError = true;\n  }\n\n  return true;\n};\n\nURLStateMachine.prototype[\"parse authority\"] = function parseAuthority(c, cStr) {\n  if (c === p(\"@\")) {\n    this.parseError = true;\n\n    if (this.atFlag) {\n      this.buffer = `%40${this.buffer}`;\n    }\n\n    this.atFlag = true; // careful, this is based on buffer and has its own pointer (this.pointer != pointer) and inner chars\n\n    const len = countSymbols(this.buffer);\n\n    for (let pointer = 0; pointer < len; ++pointer) {\n      const codePoint = this.buffer.codePointAt(pointer);\n\n      if (codePoint === p(\":\") && !this.passwordTokenSeenFlag) {\n        this.passwordTokenSeenFlag = true;\n        continue;\n      }\n\n      const encodedCodePoints = utf8PercentEncodeCodePoint(codePoint, isUserinfoPercentEncode);\n\n      if (this.passwordTokenSeenFlag) {\n        this.url.password += encodedCodePoints;\n      } else {\n        this.url.username += encodedCodePoints;\n      }\n    }\n\n    this.buffer = \"\";\n  } else if (isNaN(c) || c === p(\"/\") || c === p(\"?\") || c === p(\"#\") || isSpecial(this.url) && c === p(\"\\\\\")) {\n    if (this.atFlag && this.buffer === \"\") {\n      this.parseError = true;\n      return failure;\n    }\n\n    this.pointer -= countSymbols(this.buffer) + 1;\n    this.buffer = \"\";\n    this.state = \"host\";\n  } else {\n    this.buffer += cStr;\n  }\n\n  return true;\n};\n\nURLStateMachine.prototype[\"parse hostname\"] = URLStateMachine.prototype[\"parse host\"] = function parseHostName(c, cStr) {\n  if (this.stateOverride && this.url.scheme === \"file\") {\n    --this.pointer;\n    this.state = \"file host\";\n  } else if (c === p(\":\") && !this.arrFlag) {\n    if (this.buffer === \"\") {\n      this.parseError = true;\n      return failure;\n    }\n\n    if (this.stateOverride === \"hostname\") {\n      return false;\n    }\n\n    const host = parseHost(this.buffer, isNotSpecial(this.url));\n\n    if (host === failure) {\n      return failure;\n    }\n\n    this.url.host = host;\n    this.buffer = \"\";\n    this.state = \"port\";\n  } else if (isNaN(c) || c === p(\"/\") || c === p(\"?\") || c === p(\"#\") || isSpecial(this.url) && c === p(\"\\\\\")) {\n    --this.pointer;\n\n    if (isSpecial(this.url) && this.buffer === \"\") {\n      this.parseError = true;\n      return failure;\n    } else if (this.stateOverride && this.buffer === \"\" && (includesCredentials(this.url) || this.url.port !== null)) {\n      this.parseError = true;\n      return false;\n    }\n\n    const host = parseHost(this.buffer, isNotSpecial(this.url));\n\n    if (host === failure) {\n      return failure;\n    }\n\n    this.url.host = host;\n    this.buffer = \"\";\n    this.state = \"path start\";\n\n    if (this.stateOverride) {\n      return false;\n    }\n  } else {\n    if (c === p(\"[\")) {\n      this.arrFlag = true;\n    } else if (c === p(\"]\")) {\n      this.arrFlag = false;\n    }\n\n    this.buffer += cStr;\n  }\n\n  return true;\n};\n\nURLStateMachine.prototype[\"parse port\"] = function parsePort(c, cStr) {\n  if (infra.isASCIIDigit(c)) {\n    this.buffer += cStr;\n  } else if (isNaN(c) || c === p(\"/\") || c === p(\"?\") || c === p(\"#\") || isSpecial(this.url) && c === p(\"\\\\\") || this.stateOverride) {\n    if (this.buffer !== \"\") {\n      const port = parseInt(this.buffer);\n\n      if (port > 2 ** 16 - 1) {\n        this.parseError = true;\n        return failure;\n      }\n\n      this.url.port = port === defaultPort(this.url.scheme) ? null : port;\n      this.buffer = \"\";\n    }\n\n    if (this.stateOverride) {\n      return false;\n    }\n\n    this.state = \"path start\";\n    --this.pointer;\n  } else {\n    this.parseError = true;\n    return failure;\n  }\n\n  return true;\n};\n\nconst fileOtherwiseCodePoints = new Set([p(\"/\"), p(\"\\\\\"), p(\"?\"), p(\"#\")]);\n\nfunction startsWithWindowsDriveLetter(input, pointer) {\n  const length = input.length - pointer;\n  return length >= 2 && isWindowsDriveLetterCodePoints(input[pointer], input[pointer + 1]) && (length === 2 || fileOtherwiseCodePoints.has(input[pointer + 2]));\n}\n\nURLStateMachine.prototype[\"parse file\"] = function parseFile(c) {\n  this.url.scheme = \"file\";\n  this.url.host = \"\";\n\n  if (c === p(\"/\") || c === p(\"\\\\\")) {\n    if (c === p(\"\\\\\")) {\n      this.parseError = true;\n    }\n\n    this.state = \"file slash\";\n  } else if (this.base !== null && this.base.scheme === \"file\") {\n    this.url.host = this.base.host;\n    this.url.path = this.base.path.slice();\n    this.url.query = this.base.query;\n\n    if (c === p(\"?\")) {\n      this.url.query = \"\";\n      this.state = \"query\";\n    } else if (c === p(\"#\")) {\n      this.url.fragment = \"\";\n      this.state = \"fragment\";\n    } else if (!isNaN(c)) {\n      this.url.query = null;\n\n      if (!startsWithWindowsDriveLetter(this.input, this.pointer)) {\n        shortenPath(this.url);\n      } else {\n        this.parseError = true;\n        this.url.path = [];\n      }\n\n      this.state = \"path\";\n      --this.pointer;\n    }\n  } else {\n    this.state = \"path\";\n    --this.pointer;\n  }\n\n  return true;\n};\n\nURLStateMachine.prototype[\"parse file slash\"] = function parseFileSlash(c) {\n  if (c === p(\"/\") || c === p(\"\\\\\")) {\n    if (c === p(\"\\\\\")) {\n      this.parseError = true;\n    }\n\n    this.state = \"file host\";\n  } else {\n    if (this.base !== null && this.base.scheme === \"file\") {\n      if (!startsWithWindowsDriveLetter(this.input, this.pointer) && isNormalizedWindowsDriveLetterString(this.base.path[0])) {\n        this.url.path.push(this.base.path[0]);\n      }\n\n      this.url.host = this.base.host;\n    }\n\n    this.state = \"path\";\n    --this.pointer;\n  }\n\n  return true;\n};\n\nURLStateMachine.prototype[\"parse file host\"] = function parseFileHost(c, cStr) {\n  if (isNaN(c) || c === p(\"/\") || c === p(\"\\\\\") || c === p(\"?\") || c === p(\"#\")) {\n    --this.pointer;\n\n    if (!this.stateOverride && isWindowsDriveLetterString(this.buffer)) {\n      this.parseError = true;\n      this.state = \"path\";\n    } else if (this.buffer === \"\") {\n      this.url.host = \"\";\n\n      if (this.stateOverride) {\n        return false;\n      }\n\n      this.state = \"path start\";\n    } else {\n      let host = parseHost(this.buffer, isNotSpecial(this.url));\n\n      if (host === failure) {\n        return failure;\n      }\n\n      if (host === \"localhost\") {\n        host = \"\";\n      }\n\n      this.url.host = host;\n\n      if (this.stateOverride) {\n        return false;\n      }\n\n      this.buffer = \"\";\n      this.state = \"path start\";\n    }\n  } else {\n    this.buffer += cStr;\n  }\n\n  return true;\n};\n\nURLStateMachine.prototype[\"parse path start\"] = function parsePathStart(c) {\n  if (isSpecial(this.url)) {\n    if (c === p(\"\\\\\")) {\n      this.parseError = true;\n    }\n\n    this.state = \"path\";\n\n    if (c !== p(\"/\") && c !== p(\"\\\\\")) {\n      --this.pointer;\n    }\n  } else if (!this.stateOverride && c === p(\"?\")) {\n    this.url.query = \"\";\n    this.state = \"query\";\n  } else if (!this.stateOverride && c === p(\"#\")) {\n    this.url.fragment = \"\";\n    this.state = \"fragment\";\n  } else if (c !== undefined) {\n    this.state = \"path\";\n\n    if (c !== p(\"/\")) {\n      --this.pointer;\n    }\n  } else if (this.stateOverride && this.url.host === null) {\n    this.url.path.push(\"\");\n  }\n\n  return true;\n};\n\nURLStateMachine.prototype[\"parse path\"] = function parsePath(c) {\n  if (isNaN(c) || c === p(\"/\") || isSpecial(this.url) && c === p(\"\\\\\") || !this.stateOverride && (c === p(\"?\") || c === p(\"#\"))) {\n    if (isSpecial(this.url) && c === p(\"\\\\\")) {\n      this.parseError = true;\n    }\n\n    if (isDoubleDot(this.buffer)) {\n      shortenPath(this.url);\n\n      if (c !== p(\"/\") && !(isSpecial(this.url) && c === p(\"\\\\\"))) {\n        this.url.path.push(\"\");\n      }\n    } else if (isSingleDot(this.buffer) && c !== p(\"/\") && !(isSpecial(this.url) && c === p(\"\\\\\"))) {\n      this.url.path.push(\"\");\n    } else if (!isSingleDot(this.buffer)) {\n      if (this.url.scheme === \"file\" && this.url.path.length === 0 && isWindowsDriveLetterString(this.buffer)) {\n        this.buffer = `${this.buffer[0]}:`;\n      }\n\n      this.url.path.push(this.buffer);\n    }\n\n    this.buffer = \"\";\n\n    if (c === p(\"?\")) {\n      this.url.query = \"\";\n      this.state = \"query\";\n    }\n\n    if (c === p(\"#\")) {\n      this.url.fragment = \"\";\n      this.state = \"fragment\";\n    }\n  } else {\n    // TODO: If c is not a URL code point and not \"%\", parse error.\n    if (c === p(\"%\") && (!infra.isASCIIHex(this.input[this.pointer + 1]) || !infra.isASCIIHex(this.input[this.pointer + 2]))) {\n      this.parseError = true;\n    }\n\n    this.buffer += utf8PercentEncodeCodePoint(c, isPathPercentEncode);\n  }\n\n  return true;\n};\n\nURLStateMachine.prototype[\"parse opaque path\"] = function parseOpaquePath(c) {\n  if (c === p(\"?\")) {\n    this.url.query = \"\";\n    this.state = \"query\";\n  } else if (c === p(\"#\")) {\n    this.url.fragment = \"\";\n    this.state = \"fragment\";\n  } else {\n    // TODO: Add: not a URL code point\n    if (!isNaN(c) && c !== p(\"%\")) {\n      this.parseError = true;\n    }\n\n    if (c === p(\"%\") && (!infra.isASCIIHex(this.input[this.pointer + 1]) || !infra.isASCIIHex(this.input[this.pointer + 2]))) {\n      this.parseError = true;\n    }\n\n    if (!isNaN(c)) {\n      this.url.path += utf8PercentEncodeCodePoint(c, isC0ControlPercentEncode);\n    }\n  }\n\n  return true;\n};\n\nURLStateMachine.prototype[\"parse query\"] = function parseQuery(c, cStr) {\n  if (!isSpecial(this.url) || this.url.scheme === \"ws\" || this.url.scheme === \"wss\") {\n    this.encodingOverride = \"utf-8\";\n  }\n\n  if (!this.stateOverride && c === p(\"#\") || isNaN(c)) {\n    const queryPercentEncodePredicate = isSpecial(this.url) ? isSpecialQueryPercentEncode : isQueryPercentEncode;\n    this.url.query += utf8PercentEncodeString(this.buffer, queryPercentEncodePredicate);\n    this.buffer = \"\";\n\n    if (c === p(\"#\")) {\n      this.url.fragment = \"\";\n      this.state = \"fragment\";\n    }\n  } else if (!isNaN(c)) {\n    // TODO: If c is not a URL code point and not \"%\", parse error.\n    if (c === p(\"%\") && (!infra.isASCIIHex(this.input[this.pointer + 1]) || !infra.isASCIIHex(this.input[this.pointer + 2]))) {\n      this.parseError = true;\n    }\n\n    this.buffer += cStr;\n  }\n\n  return true;\n};\n\nURLStateMachine.prototype[\"parse fragment\"] = function parseFragment(c) {\n  if (!isNaN(c)) {\n    // TODO: If c is not a URL code point and not \"%\", parse error.\n    if (c === p(\"%\") && (!infra.isASCIIHex(this.input[this.pointer + 1]) || !infra.isASCIIHex(this.input[this.pointer + 2]))) {\n      this.parseError = true;\n    }\n\n    this.url.fragment += utf8PercentEncodeCodePoint(c, isFragmentPercentEncode);\n  }\n\n  return true;\n};\n\nfunction serializeURL(url, excludeFragment) {\n  let output = `${url.scheme}:`;\n\n  if (url.host !== null) {\n    output += \"//\";\n\n    if (url.username !== \"\" || url.password !== \"\") {\n      output += url.username;\n\n      if (url.password !== \"\") {\n        output += `:${url.password}`;\n      }\n\n      output += \"@\";\n    }\n\n    output += serializeHost(url.host);\n\n    if (url.port !== null) {\n      output += `:${url.port}`;\n    }\n  }\n\n  if (url.host === null && !hasAnOpaquePath(url) && url.path.length > 1 && url.path[0] === \"\") {\n    output += \"/.\";\n  }\n\n  output += serializePath(url);\n\n  if (url.query !== null) {\n    output += `?${url.query}`;\n  }\n\n  if (!excludeFragment && url.fragment !== null) {\n    output += `#${url.fragment}`;\n  }\n\n  return output;\n}\n\nfunction serializeOrigin(tuple) {\n  let result = `${tuple.scheme}://`;\n  result += serializeHost(tuple.host);\n\n  if (tuple.port !== null) {\n    result += `:${tuple.port}`;\n  }\n\n  return result;\n}\n\nfunction serializePath(url) {\n  if (hasAnOpaquePath(url)) {\n    return url.path;\n  }\n\n  let output = \"\";\n\n  for (const segment of url.path) {\n    output += `/${segment}`;\n  }\n\n  return output;\n}\n\nmodule.exports.serializeURL = serializeURL;\nmodule.exports.serializePath = serializePath;\n\nmodule.exports.serializeURLOrigin = function (url) {\n  // https://url.spec.whatwg.org/#concept-url-origin\n  switch (url.scheme) {\n    case \"blob\":\n      try {\n        return module.exports.serializeURLOrigin(module.exports.parseURL(serializePath(url)));\n      } catch (e) {\n        // serializing an opaque origin returns \"null\"\n        return \"null\";\n      }\n\n    case \"ftp\":\n    case \"http\":\n    case \"https\":\n    case \"ws\":\n    case \"wss\":\n      return serializeOrigin({\n        scheme: url.scheme,\n        host: url.host,\n        port: url.port\n      });\n\n    case \"file\":\n      // The spec says:\n      // > Unfortunate as it is, this is left as an exercise to the reader. When in doubt, return a new opaque origin.\n      // Browsers tested so far:\n      // - Chrome says \"file://\", but treats file: URLs as cross-origin for most (all?) purposes; see e.g.\n      //   https://bugs.chromium.org/p/chromium/issues/detail?id=37586\n      // - Firefox says \"null\", but treats file: URLs as same-origin sometimes based on directory stuff; see\n      //   https://developer.mozilla.org/en-US/docs/Archive/Misc_top_level/Same-origin_policy_for_file:_URIs\n      return \"null\";\n\n    default:\n      // serializing an opaque origin returns \"null\"\n      return \"null\";\n  }\n};\n\nmodule.exports.basicURLParse = function (input, options) {\n  if (options === undefined) {\n    options = {};\n  }\n\n  const usm = new URLStateMachine(input, options.baseURL, options.encodingOverride, options.url, options.stateOverride);\n\n  if (usm.failure) {\n    return null;\n  }\n\n  return usm.url;\n};\n\nmodule.exports.setTheUsername = function (url, username) {\n  url.username = utf8PercentEncodeString(username, isUserinfoPercentEncode);\n};\n\nmodule.exports.setThePassword = function (url, password) {\n  url.password = utf8PercentEncodeString(password, isUserinfoPercentEncode);\n};\n\nmodule.exports.serializeHost = serializeHost;\nmodule.exports.cannotHaveAUsernamePasswordPort = cannotHaveAUsernamePasswordPort;\nmodule.exports.hasAnOpaquePath = hasAnOpaquePath;\n\nmodule.exports.serializeInteger = function (integer) {\n  return String(integer);\n};\n\nmodule.exports.parseURL = function (input, options) {\n  if (options === undefined) {\n    options = {};\n  } // We don't handle blobs, so this just delegates:\n\n\n  return module.exports.basicURLParse(input, {\n    baseURL: options.baseURL,\n    encodingOverride: options.encodingOverride\n  });\n};","map":{"version":3,"sources":["D:/Barcelparts/node_modules/mongodb-connection-string-url/node_modules/whatwg-url/lib/url-state-machine.js"],"names":["tr46","require","infra","utf8DecodeWithoutBOM","percentDecodeString","utf8PercentEncodeCodePoint","utf8PercentEncodeString","isC0ControlPercentEncode","isFragmentPercentEncode","isQueryPercentEncode","isSpecialQueryPercentEncode","isPathPercentEncode","isUserinfoPercentEncode","p","char","codePointAt","specialSchemes","ftp","file","http","https","ws","wss","failure","Symbol","countSymbols","str","length","at","input","idx","c","isNaN","undefined","String","fromCodePoint","isSingleDot","buffer","toLowerCase","isDoubleDot","isWindowsDriveLetterCodePoints","cp1","cp2","isASCIIAlpha","isWindowsDriveLetterString","string","isNormalizedWindowsDriveLetterString","containsForbiddenHostCodePoint","search","containsForbiddenHostCodePointExcludingPercent","isSpecialScheme","scheme","isSpecial","url","isNotSpecial","defaultPort","parseIPv4Number","R","charAt","substring","regex","test","parseInt","parseIPv4","parts","split","pop","numbers","part","n","push","i","ipv4","counter","serializeIPv4","address","output","Math","floor","parseIPv6","pieceIndex","compress","pointer","Array","from","value","isASCIIHex","numbersSeen","ipv4Piece","isASCIIDigit","number","swaps","temp","serializeIPv6","findLongestZeroSequence","ignore0","separator","toString","parseHost","isNotSpecialArg","parseOpaqueHost","domain","asciiDomain","domainToASCII","endsInANumber","last","arr","maxIdx","maxLen","currStart","currLen","serializeHost","host","beStrict","result","toASCII","checkBidi","checkHyphens","checkJoiners","useSTD3ASCIIRules","verifyDNSLength","trimControlChars","replace","trimTabAndNewline","shortenPath","path","isNormalizedWindowsDriveLetter","includesCredentials","username","password","cannotHaveAUsernamePasswordPort","hasAnOpaquePath","URLStateMachine","base","encodingOverride","stateOverride","parseError","port","query","fragment","res","state","atFlag","arrFlag","passwordTokenSeenFlag","cStr","ret","prototype","parseSchemeStart","parseScheme","isASCIIAlphanumeric","parseNoScheme","parseSpecialRelativeOrAuthority","parsePathOrAuthority","parseRelative","slice","parseRelativeSlash","parseSpecialAuthoritySlashes","parseSpecialAuthorityIgnoreSlashes","parseAuthority","len","codePoint","encodedCodePoints","parseHostName","parsePort","fileOtherwiseCodePoints","Set","startsWithWindowsDriveLetter","has","parseFile","parseFileSlash","parseFileHost","parsePathStart","parsePath","parseOpaquePath","parseQuery","queryPercentEncodePredicate","parseFragment","serializeURL","excludeFragment","serializePath","serializeOrigin","tuple","segment","module","exports","serializeURLOrigin","parseURL","e","basicURLParse","options","usm","baseURL","setTheUsername","setThePassword","serializeInteger","integer"],"mappings":"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","sourcesContent":["\"use strict\";\r\nconst tr46 = require(\"tr46\");\r\n\r\nconst infra = require(\"./infra\");\r\nconst { utf8DecodeWithoutBOM } = require(\"./encoding\");\r\nconst { percentDecodeString, utf8PercentEncodeCodePoint, utf8PercentEncodeString, isC0ControlPercentEncode,\r\n  isFragmentPercentEncode, isQueryPercentEncode, isSpecialQueryPercentEncode, isPathPercentEncode,\r\n  isUserinfoPercentEncode } = require(\"./percent-encoding\");\r\n\r\nfunction p(char) {\r\n  return char.codePointAt(0);\r\n}\r\n\r\nconst specialSchemes = {\r\n  ftp: 21,\r\n  file: null,\r\n  http: 80,\r\n  https: 443,\r\n  ws: 80,\r\n  wss: 443\r\n};\r\n\r\nconst failure = Symbol(\"failure\");\r\n\r\nfunction countSymbols(str) {\r\n  return [...str].length;\r\n}\r\n\r\nfunction at(input, idx) {\r\n  const c = input[idx];\r\n  return isNaN(c) ? undefined : String.fromCodePoint(c);\r\n}\r\n\r\nfunction isSingleDot(buffer) {\r\n  return buffer === \".\" || buffer.toLowerCase() === \"%2e\";\r\n}\r\n\r\nfunction isDoubleDot(buffer) {\r\n  buffer = buffer.toLowerCase();\r\n  return buffer === \"..\" || buffer === \"%2e.\" || buffer === \".%2e\" || buffer === \"%2e%2e\";\r\n}\r\n\r\nfunction isWindowsDriveLetterCodePoints(cp1, cp2) {\r\n  return infra.isASCIIAlpha(cp1) && (cp2 === p(\":\") || cp2 === p(\"|\"));\r\n}\r\n\r\nfunction isWindowsDriveLetterString(string) {\r\n  return string.length === 2 && infra.isASCIIAlpha(string.codePointAt(0)) && (string[1] === \":\" || string[1] === \"|\");\r\n}\r\n\r\nfunction isNormalizedWindowsDriveLetterString(string) {\r\n  return string.length === 2 && infra.isASCIIAlpha(string.codePointAt(0)) && string[1] === \":\";\r\n}\r\n\r\nfunction containsForbiddenHostCodePoint(string) {\r\n  return string.search(/\\u0000|\\u0009|\\u000A|\\u000D|\\u0020|#|%|\\/|:|<|>|\\?|@|\\[|\\\\|\\]|\\^|\\|/u) !== -1;\r\n}\r\n\r\nfunction containsForbiddenHostCodePointExcludingPercent(string) {\r\n  return string.search(/\\u0000|\\u0009|\\u000A|\\u000D|\\u0020|#|\\/|:|<|>|\\?|@|\\[|\\\\|\\]|\\^|\\|/u) !== -1;\r\n}\r\n\r\nfunction isSpecialScheme(scheme) {\r\n  return specialSchemes[scheme] !== undefined;\r\n}\r\n\r\nfunction isSpecial(url) {\r\n  return isSpecialScheme(url.scheme);\r\n}\r\n\r\nfunction isNotSpecial(url) {\r\n  return !isSpecialScheme(url.scheme);\r\n}\r\n\r\nfunction defaultPort(scheme) {\r\n  return specialSchemes[scheme];\r\n}\r\n\r\nfunction parseIPv4Number(input) {\r\n  if (input === \"\") {\r\n    return failure;\r\n  }\r\n\r\n  let R = 10;\r\n\r\n  if (input.length >= 2 && input.charAt(0) === \"0\" && input.charAt(1).toLowerCase() === \"x\") {\r\n    input = input.substring(2);\r\n    R = 16;\r\n  } else if (input.length >= 2 && input.charAt(0) === \"0\") {\r\n    input = input.substring(1);\r\n    R = 8;\r\n  }\r\n\r\n  if (input === \"\") {\r\n    return 0;\r\n  }\r\n\r\n  let regex = /[^0-7]/u;\r\n  if (R === 10) {\r\n    regex = /[^0-9]/u;\r\n  }\r\n  if (R === 16) {\r\n    regex = /[^0-9A-Fa-f]/u;\r\n  }\r\n\r\n  if (regex.test(input)) {\r\n    return failure;\r\n  }\r\n\r\n  return parseInt(input, R);\r\n}\r\n\r\nfunction parseIPv4(input) {\r\n  const parts = input.split(\".\");\r\n  if (parts[parts.length - 1] === \"\") {\r\n    if (parts.length > 1) {\r\n      parts.pop();\r\n    }\r\n  }\r\n\r\n  if (parts.length > 4) {\r\n    return failure;\r\n  }\r\n\r\n  const numbers = [];\r\n  for (const part of parts) {\r\n    const n = parseIPv4Number(part);\r\n    if (n === failure) {\r\n      return failure;\r\n    }\r\n\r\n    numbers.push(n);\r\n  }\r\n\r\n  for (let i = 0; i < numbers.length - 1; ++i) {\r\n    if (numbers[i] > 255) {\r\n      return failure;\r\n    }\r\n  }\r\n  if (numbers[numbers.length - 1] >= 256 ** (5 - numbers.length)) {\r\n    return failure;\r\n  }\r\n\r\n  let ipv4 = numbers.pop();\r\n  let counter = 0;\r\n\r\n  for (const n of numbers) {\r\n    ipv4 += n * 256 ** (3 - counter);\r\n    ++counter;\r\n  }\r\n\r\n  return ipv4;\r\n}\r\n\r\nfunction serializeIPv4(address) {\r\n  let output = \"\";\r\n  let n = address;\r\n\r\n  for (let i = 1; i <= 4; ++i) {\r\n    output = String(n % 256) + output;\r\n    if (i !== 4) {\r\n      output = `.${output}`;\r\n    }\r\n    n = Math.floor(n / 256);\r\n  }\r\n\r\n  return output;\r\n}\r\n\r\nfunction parseIPv6(input) {\r\n  const address = [0, 0, 0, 0, 0, 0, 0, 0];\r\n  let pieceIndex = 0;\r\n  let compress = null;\r\n  let pointer = 0;\r\n\r\n  input = Array.from(input, c => c.codePointAt(0));\r\n\r\n  if (input[pointer] === p(\":\")) {\r\n    if (input[pointer + 1] !== p(\":\")) {\r\n      return failure;\r\n    }\r\n\r\n    pointer += 2;\r\n    ++pieceIndex;\r\n    compress = pieceIndex;\r\n  }\r\n\r\n  while (pointer < input.length) {\r\n    if (pieceIndex === 8) {\r\n      return failure;\r\n    }\r\n\r\n    if (input[pointer] === p(\":\")) {\r\n      if (compress !== null) {\r\n        return failure;\r\n      }\r\n      ++pointer;\r\n      ++pieceIndex;\r\n      compress = pieceIndex;\r\n      continue;\r\n    }\r\n\r\n    let value = 0;\r\n    let length = 0;\r\n\r\n    while (length < 4 && infra.isASCIIHex(input[pointer])) {\r\n      value = value * 0x10 + parseInt(at(input, pointer), 16);\r\n      ++pointer;\r\n      ++length;\r\n    }\r\n\r\n    if (input[pointer] === p(\".\")) {\r\n      if (length === 0) {\r\n        return failure;\r\n      }\r\n\r\n      pointer -= length;\r\n\r\n      if (pieceIndex > 6) {\r\n        return failure;\r\n      }\r\n\r\n      let numbersSeen = 0;\r\n\r\n      while (input[pointer] !== undefined) {\r\n        let ipv4Piece = null;\r\n\r\n        if (numbersSeen > 0) {\r\n          if (input[pointer] === p(\".\") && numbersSeen < 4) {\r\n            ++pointer;\r\n          } else {\r\n            return failure;\r\n          }\r\n        }\r\n\r\n        if (!infra.isASCIIDigit(input[pointer])) {\r\n          return failure;\r\n        }\r\n\r\n        while (infra.isASCIIDigit(input[pointer])) {\r\n          const number = parseInt(at(input, pointer));\r\n          if (ipv4Piece === null) {\r\n            ipv4Piece = number;\r\n          } else if (ipv4Piece === 0) {\r\n            return failure;\r\n          } else {\r\n            ipv4Piece = ipv4Piece * 10 + number;\r\n          }\r\n          if (ipv4Piece > 255) {\r\n            return failure;\r\n          }\r\n          ++pointer;\r\n        }\r\n\r\n        address[pieceIndex] = address[pieceIndex] * 0x100 + ipv4Piece;\r\n\r\n        ++numbersSeen;\r\n\r\n        if (numbersSeen === 2 || numbersSeen === 4) {\r\n          ++pieceIndex;\r\n        }\r\n      }\r\n\r\n      if (numbersSeen !== 4) {\r\n        return failure;\r\n      }\r\n\r\n      break;\r\n    } else if (input[pointer] === p(\":\")) {\r\n      ++pointer;\r\n      if (input[pointer] === undefined) {\r\n        return failure;\r\n      }\r\n    } else if (input[pointer] !== undefined) {\r\n      return failure;\r\n    }\r\n\r\n    address[pieceIndex] = value;\r\n    ++pieceIndex;\r\n  }\r\n\r\n  if (compress !== null) {\r\n    let swaps = pieceIndex - compress;\r\n    pieceIndex = 7;\r\n    while (pieceIndex !== 0 && swaps > 0) {\r\n      const temp = address[compress + swaps - 1];\r\n      address[compress + swaps - 1] = address[pieceIndex];\r\n      address[pieceIndex] = temp;\r\n      --pieceIndex;\r\n      --swaps;\r\n    }\r\n  } else if (compress === null && pieceIndex !== 8) {\r\n    return failure;\r\n  }\r\n\r\n  return address;\r\n}\r\n\r\nfunction serializeIPv6(address) {\r\n  let output = \"\";\r\n  const compress = findLongestZeroSequence(address);\r\n  let ignore0 = false;\r\n\r\n  for (let pieceIndex = 0; pieceIndex <= 7; ++pieceIndex) {\r\n    if (ignore0 && address[pieceIndex] === 0) {\r\n      continue;\r\n    } else if (ignore0) {\r\n      ignore0 = false;\r\n    }\r\n\r\n    if (compress === pieceIndex) {\r\n      const separator = pieceIndex === 0 ? \"::\" : \":\";\r\n      output += separator;\r\n      ignore0 = true;\r\n      continue;\r\n    }\r\n\r\n    output += address[pieceIndex].toString(16);\r\n\r\n    if (pieceIndex !== 7) {\r\n      output += \":\";\r\n    }\r\n  }\r\n\r\n  return output;\r\n}\r\n\r\nfunction parseHost(input, isNotSpecialArg = false) {\r\n  if (input[0] === \"[\") {\r\n    if (input[input.length - 1] !== \"]\") {\r\n      return failure;\r\n    }\r\n\r\n    return parseIPv6(input.substring(1, input.length - 1));\r\n  }\r\n\r\n  if (isNotSpecialArg) {\r\n    return parseOpaqueHost(input);\r\n  }\r\n\r\n  const domain = utf8DecodeWithoutBOM(percentDecodeString(input));\r\n  const asciiDomain = domainToASCII(domain);\r\n  if (asciiDomain === failure) {\r\n    return failure;\r\n  }\r\n\r\n  if (containsForbiddenHostCodePoint(asciiDomain)) {\r\n    return failure;\r\n  }\r\n\r\n  if (endsInANumber(asciiDomain)) {\r\n    return parseIPv4(asciiDomain);\r\n  }\r\n\r\n  return asciiDomain;\r\n}\r\n\r\nfunction endsInANumber(input) {\r\n  const parts = input.split(\".\");\r\n  if (parts[parts.length - 1] === \"\") {\r\n    if (parts.length === 1) {\r\n      return false;\r\n    }\r\n    parts.pop();\r\n  }\r\n\r\n  const last = parts[parts.length - 1];\r\n  if (parseIPv4Number(last) !== failure) {\r\n    return true;\r\n  }\r\n\r\n  if (/^[0-9]+$/u.test(last)) {\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nfunction parseOpaqueHost(input) {\r\n  if (containsForbiddenHostCodePointExcludingPercent(input)) {\r\n    return failure;\r\n  }\r\n\r\n  return utf8PercentEncodeString(input, isC0ControlPercentEncode);\r\n}\r\n\r\nfunction findLongestZeroSequence(arr) {\r\n  let maxIdx = null;\r\n  let maxLen = 1; // only find elements > 1\r\n  let currStart = null;\r\n  let currLen = 0;\r\n\r\n  for (let i = 0; i < arr.length; ++i) {\r\n    if (arr[i] !== 0) {\r\n      if (currLen > maxLen) {\r\n        maxIdx = currStart;\r\n        maxLen = currLen;\r\n      }\r\n\r\n      currStart = null;\r\n      currLen = 0;\r\n    } else {\r\n      if (currStart === null) {\r\n        currStart = i;\r\n      }\r\n      ++currLen;\r\n    }\r\n  }\r\n\r\n  // if trailing zeros\r\n  if (currLen > maxLen) {\r\n    return currStart;\r\n  }\r\n\r\n  return maxIdx;\r\n}\r\n\r\nfunction serializeHost(host) {\r\n  if (typeof host === \"number\") {\r\n    return serializeIPv4(host);\r\n  }\r\n\r\n  // IPv6 serializer\r\n  if (host instanceof Array) {\r\n    return `[${serializeIPv6(host)}]`;\r\n  }\r\n\r\n  return host;\r\n}\r\n\r\nfunction domainToASCII(domain, beStrict = false) {\r\n  const result = tr46.toASCII(domain, {\r\n    checkBidi: true,\r\n    checkHyphens: false,\r\n    checkJoiners: true,\r\n    useSTD3ASCIIRules: beStrict,\r\n    verifyDNSLength: beStrict\r\n  });\r\n  if (result === null || result === \"\") {\r\n    return failure;\r\n  }\r\n  return result;\r\n}\r\n\r\nfunction trimControlChars(url) {\r\n  return url.replace(/^[\\u0000-\\u001F\\u0020]+|[\\u0000-\\u001F\\u0020]+$/ug, \"\");\r\n}\r\n\r\nfunction trimTabAndNewline(url) {\r\n  return url.replace(/\\u0009|\\u000A|\\u000D/ug, \"\");\r\n}\r\n\r\nfunction shortenPath(url) {\r\n  const { path } = url;\r\n  if (path.length === 0) {\r\n    return;\r\n  }\r\n  if (url.scheme === \"file\" && path.length === 1 && isNormalizedWindowsDriveLetter(path[0])) {\r\n    return;\r\n  }\r\n\r\n  path.pop();\r\n}\r\n\r\nfunction includesCredentials(url) {\r\n  return url.username !== \"\" || url.password !== \"\";\r\n}\r\n\r\nfunction cannotHaveAUsernamePasswordPort(url) {\r\n  return url.host === null || url.host === \"\" || hasAnOpaquePath(url) || url.scheme === \"file\";\r\n}\r\n\r\nfunction hasAnOpaquePath(url) {\r\n  return typeof url.path === \"string\";\r\n}\r\n\r\nfunction isNormalizedWindowsDriveLetter(string) {\r\n  return /^[A-Za-z]:$/u.test(string);\r\n}\r\n\r\nfunction URLStateMachine(input, base, encodingOverride, url, stateOverride) {\r\n  this.pointer = 0;\r\n  this.input = input;\r\n  this.base = base || null;\r\n  this.encodingOverride = encodingOverride || \"utf-8\";\r\n  this.stateOverride = stateOverride;\r\n  this.url = url;\r\n  this.failure = false;\r\n  this.parseError = false;\r\n\r\n  if (!this.url) {\r\n    this.url = {\r\n      scheme: \"\",\r\n      username: \"\",\r\n      password: \"\",\r\n      host: null,\r\n      port: null,\r\n      path: [],\r\n      query: null,\r\n      fragment: null\r\n    };\r\n\r\n    const res = trimControlChars(this.input);\r\n    if (res !== this.input) {\r\n      this.parseError = true;\r\n    }\r\n    this.input = res;\r\n  }\r\n\r\n  const res = trimTabAndNewline(this.input);\r\n  if (res !== this.input) {\r\n    this.parseError = true;\r\n  }\r\n  this.input = res;\r\n\r\n  this.state = stateOverride || \"scheme start\";\r\n\r\n  this.buffer = \"\";\r\n  this.atFlag = false;\r\n  this.arrFlag = false;\r\n  this.passwordTokenSeenFlag = false;\r\n\r\n  this.input = Array.from(this.input, c => c.codePointAt(0));\r\n\r\n  for (; this.pointer <= this.input.length; ++this.pointer) {\r\n    const c = this.input[this.pointer];\r\n    const cStr = isNaN(c) ? undefined : String.fromCodePoint(c);\r\n\r\n    // exec state machine\r\n    const ret = this[`parse ${this.state}`](c, cStr);\r\n    if (!ret) {\r\n      break; // terminate algorithm\r\n    } else if (ret === failure) {\r\n      this.failure = true;\r\n      break;\r\n    }\r\n  }\r\n}\r\n\r\nURLStateMachine.prototype[\"parse scheme start\"] = function parseSchemeStart(c, cStr) {\r\n  if (infra.isASCIIAlpha(c)) {\r\n    this.buffer += cStr.toLowerCase();\r\n    this.state = \"scheme\";\r\n  } else if (!this.stateOverride) {\r\n    this.state = \"no scheme\";\r\n    --this.pointer;\r\n  } else {\r\n    this.parseError = true;\r\n    return failure;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse scheme\"] = function parseScheme(c, cStr) {\r\n  if (infra.isASCIIAlphanumeric(c) || c === p(\"+\") || c === p(\"-\") || c === p(\".\")) {\r\n    this.buffer += cStr.toLowerCase();\r\n  } else if (c === p(\":\")) {\r\n    if (this.stateOverride) {\r\n      if (isSpecial(this.url) && !isSpecialScheme(this.buffer)) {\r\n        return false;\r\n      }\r\n\r\n      if (!isSpecial(this.url) && isSpecialScheme(this.buffer)) {\r\n        return false;\r\n      }\r\n\r\n      if ((includesCredentials(this.url) || this.url.port !== null) && this.buffer === \"file\") {\r\n        return false;\r\n      }\r\n\r\n      if (this.url.scheme === \"file\" && this.url.host === \"\") {\r\n        return false;\r\n      }\r\n    }\r\n    this.url.scheme = this.buffer;\r\n    if (this.stateOverride) {\r\n      if (this.url.port === defaultPort(this.url.scheme)) {\r\n        this.url.port = null;\r\n      }\r\n      return false;\r\n    }\r\n    this.buffer = \"\";\r\n    if (this.url.scheme === \"file\") {\r\n      if (this.input[this.pointer + 1] !== p(\"/\") || this.input[this.pointer + 2] !== p(\"/\")) {\r\n        this.parseError = true;\r\n      }\r\n      this.state = \"file\";\r\n    } else if (isSpecial(this.url) && this.base !== null && this.base.scheme === this.url.scheme) {\r\n      this.state = \"special relative or authority\";\r\n    } else if (isSpecial(this.url)) {\r\n      this.state = \"special authority slashes\";\r\n    } else if (this.input[this.pointer + 1] === p(\"/\")) {\r\n      this.state = \"path or authority\";\r\n      ++this.pointer;\r\n    } else {\r\n      this.url.path = \"\";\r\n      this.state = \"opaque path\";\r\n    }\r\n  } else if (!this.stateOverride) {\r\n    this.buffer = \"\";\r\n    this.state = \"no scheme\";\r\n    this.pointer = -1;\r\n  } else {\r\n    this.parseError = true;\r\n    return failure;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse no scheme\"] = function parseNoScheme(c) {\r\n  if (this.base === null || (hasAnOpaquePath(this.base) && c !== p(\"#\"))) {\r\n    return failure;\r\n  } else if (hasAnOpaquePath(this.base) && c === p(\"#\")) {\r\n    this.url.scheme = this.base.scheme;\r\n    this.url.path = this.base.path;\r\n    this.url.query = this.base.query;\r\n    this.url.fragment = \"\";\r\n    this.state = \"fragment\";\r\n  } else if (this.base.scheme === \"file\") {\r\n    this.state = \"file\";\r\n    --this.pointer;\r\n  } else {\r\n    this.state = \"relative\";\r\n    --this.pointer;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse special relative or authority\"] = function parseSpecialRelativeOrAuthority(c) {\r\n  if (c === p(\"/\") && this.input[this.pointer + 1] === p(\"/\")) {\r\n    this.state = \"special authority ignore slashes\";\r\n    ++this.pointer;\r\n  } else {\r\n    this.parseError = true;\r\n    this.state = \"relative\";\r\n    --this.pointer;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse path or authority\"] = function parsePathOrAuthority(c) {\r\n  if (c === p(\"/\")) {\r\n    this.state = \"authority\";\r\n  } else {\r\n    this.state = \"path\";\r\n    --this.pointer;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse relative\"] = function parseRelative(c) {\r\n  this.url.scheme = this.base.scheme;\r\n  if (c === p(\"/\")) {\r\n    this.state = \"relative slash\";\r\n  } else if (isSpecial(this.url) && c === p(\"\\\\\")) {\r\n    this.parseError = true;\r\n    this.state = \"relative slash\";\r\n  } else {\r\n    this.url.username = this.base.username;\r\n    this.url.password = this.base.password;\r\n    this.url.host = this.base.host;\r\n    this.url.port = this.base.port;\r\n    this.url.path = this.base.path.slice();\r\n    this.url.query = this.base.query;\r\n    if (c === p(\"?\")) {\r\n      this.url.query = \"\";\r\n      this.state = \"query\";\r\n    } else if (c === p(\"#\")) {\r\n      this.url.fragment = \"\";\r\n      this.state = \"fragment\";\r\n    } else if (!isNaN(c)) {\r\n      this.url.query = null;\r\n      this.url.path.pop();\r\n      this.state = \"path\";\r\n      --this.pointer;\r\n    }\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse relative slash\"] = function parseRelativeSlash(c) {\r\n  if (isSpecial(this.url) && (c === p(\"/\") || c === p(\"\\\\\"))) {\r\n    if (c === p(\"\\\\\")) {\r\n      this.parseError = true;\r\n    }\r\n    this.state = \"special authority ignore slashes\";\r\n  } else if (c === p(\"/\")) {\r\n    this.state = \"authority\";\r\n  } else {\r\n    this.url.username = this.base.username;\r\n    this.url.password = this.base.password;\r\n    this.url.host = this.base.host;\r\n    this.url.port = this.base.port;\r\n    this.state = \"path\";\r\n    --this.pointer;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse special authority slashes\"] = function parseSpecialAuthoritySlashes(c) {\r\n  if (c === p(\"/\") && this.input[this.pointer + 1] === p(\"/\")) {\r\n    this.state = \"special authority ignore slashes\";\r\n    ++this.pointer;\r\n  } else {\r\n    this.parseError = true;\r\n    this.state = \"special authority ignore slashes\";\r\n    --this.pointer;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse special authority ignore slashes\"] = function parseSpecialAuthorityIgnoreSlashes(c) {\r\n  if (c !== p(\"/\") && c !== p(\"\\\\\")) {\r\n    this.state = \"authority\";\r\n    --this.pointer;\r\n  } else {\r\n    this.parseError = true;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse authority\"] = function parseAuthority(c, cStr) {\r\n  if (c === p(\"@\")) {\r\n    this.parseError = true;\r\n    if (this.atFlag) {\r\n      this.buffer = `%40${this.buffer}`;\r\n    }\r\n    this.atFlag = true;\r\n\r\n    // careful, this is based on buffer and has its own pointer (this.pointer != pointer) and inner chars\r\n    const len = countSymbols(this.buffer);\r\n    for (let pointer = 0; pointer < len; ++pointer) {\r\n      const codePoint = this.buffer.codePointAt(pointer);\r\n\r\n      if (codePoint === p(\":\") && !this.passwordTokenSeenFlag) {\r\n        this.passwordTokenSeenFlag = true;\r\n        continue;\r\n      }\r\n      const encodedCodePoints = utf8PercentEncodeCodePoint(codePoint, isUserinfoPercentEncode);\r\n      if (this.passwordTokenSeenFlag) {\r\n        this.url.password += encodedCodePoints;\r\n      } else {\r\n        this.url.username += encodedCodePoints;\r\n      }\r\n    }\r\n    this.buffer = \"\";\r\n  } else if (isNaN(c) || c === p(\"/\") || c === p(\"?\") || c === p(\"#\") ||\r\n             (isSpecial(this.url) && c === p(\"\\\\\"))) {\r\n    if (this.atFlag && this.buffer === \"\") {\r\n      this.parseError = true;\r\n      return failure;\r\n    }\r\n    this.pointer -= countSymbols(this.buffer) + 1;\r\n    this.buffer = \"\";\r\n    this.state = \"host\";\r\n  } else {\r\n    this.buffer += cStr;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse hostname\"] =\r\nURLStateMachine.prototype[\"parse host\"] = function parseHostName(c, cStr) {\r\n  if (this.stateOverride && this.url.scheme === \"file\") {\r\n    --this.pointer;\r\n    this.state = \"file host\";\r\n  } else if (c === p(\":\") && !this.arrFlag) {\r\n    if (this.buffer === \"\") {\r\n      this.parseError = true;\r\n      return failure;\r\n    }\r\n\r\n    if (this.stateOverride === \"hostname\") {\r\n      return false;\r\n    }\r\n\r\n    const host = parseHost(this.buffer, isNotSpecial(this.url));\r\n    if (host === failure) {\r\n      return failure;\r\n    }\r\n\r\n    this.url.host = host;\r\n    this.buffer = \"\";\r\n    this.state = \"port\";\r\n  } else if (isNaN(c) || c === p(\"/\") || c === p(\"?\") || c === p(\"#\") ||\r\n             (isSpecial(this.url) && c === p(\"\\\\\"))) {\r\n    --this.pointer;\r\n    if (isSpecial(this.url) && this.buffer === \"\") {\r\n      this.parseError = true;\r\n      return failure;\r\n    } else if (this.stateOverride && this.buffer === \"\" &&\r\n               (includesCredentials(this.url) || this.url.port !== null)) {\r\n      this.parseError = true;\r\n      return false;\r\n    }\r\n\r\n    const host = parseHost(this.buffer, isNotSpecial(this.url));\r\n    if (host === failure) {\r\n      return failure;\r\n    }\r\n\r\n    this.url.host = host;\r\n    this.buffer = \"\";\r\n    this.state = \"path start\";\r\n    if (this.stateOverride) {\r\n      return false;\r\n    }\r\n  } else {\r\n    if (c === p(\"[\")) {\r\n      this.arrFlag = true;\r\n    } else if (c === p(\"]\")) {\r\n      this.arrFlag = false;\r\n    }\r\n    this.buffer += cStr;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse port\"] = function parsePort(c, cStr) {\r\n  if (infra.isASCIIDigit(c)) {\r\n    this.buffer += cStr;\r\n  } else if (isNaN(c) || c === p(\"/\") || c === p(\"?\") || c === p(\"#\") ||\r\n             (isSpecial(this.url) && c === p(\"\\\\\")) ||\r\n             this.stateOverride) {\r\n    if (this.buffer !== \"\") {\r\n      const port = parseInt(this.buffer);\r\n      if (port > 2 ** 16 - 1) {\r\n        this.parseError = true;\r\n        return failure;\r\n      }\r\n      this.url.port = port === defaultPort(this.url.scheme) ? null : port;\r\n      this.buffer = \"\";\r\n    }\r\n    if (this.stateOverride) {\r\n      return false;\r\n    }\r\n    this.state = \"path start\";\r\n    --this.pointer;\r\n  } else {\r\n    this.parseError = true;\r\n    return failure;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nconst fileOtherwiseCodePoints = new Set([p(\"/\"), p(\"\\\\\"), p(\"?\"), p(\"#\")]);\r\n\r\nfunction startsWithWindowsDriveLetter(input, pointer) {\r\n  const length = input.length - pointer;\r\n  return length >= 2 &&\r\n    isWindowsDriveLetterCodePoints(input[pointer], input[pointer + 1]) &&\r\n    (length === 2 || fileOtherwiseCodePoints.has(input[pointer + 2]));\r\n}\r\n\r\nURLStateMachine.prototype[\"parse file\"] = function parseFile(c) {\r\n  this.url.scheme = \"file\";\r\n  this.url.host = \"\";\r\n\r\n  if (c === p(\"/\") || c === p(\"\\\\\")) {\r\n    if (c === p(\"\\\\\")) {\r\n      this.parseError = true;\r\n    }\r\n    this.state = \"file slash\";\r\n  } else if (this.base !== null && this.base.scheme === \"file\") {\r\n    this.url.host = this.base.host;\r\n    this.url.path = this.base.path.slice();\r\n    this.url.query = this.base.query;\r\n    if (c === p(\"?\")) {\r\n      this.url.query = \"\";\r\n      this.state = \"query\";\r\n    } else if (c === p(\"#\")) {\r\n      this.url.fragment = \"\";\r\n      this.state = \"fragment\";\r\n    } else if (!isNaN(c)) {\r\n      this.url.query = null;\r\n      if (!startsWithWindowsDriveLetter(this.input, this.pointer)) {\r\n        shortenPath(this.url);\r\n      } else {\r\n        this.parseError = true;\r\n        this.url.path = [];\r\n      }\r\n\r\n      this.state = \"path\";\r\n      --this.pointer;\r\n    }\r\n  } else {\r\n    this.state = \"path\";\r\n    --this.pointer;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse file slash\"] = function parseFileSlash(c) {\r\n  if (c === p(\"/\") || c === p(\"\\\\\")) {\r\n    if (c === p(\"\\\\\")) {\r\n      this.parseError = true;\r\n    }\r\n    this.state = \"file host\";\r\n  } else {\r\n    if (this.base !== null && this.base.scheme === \"file\") {\r\n      if (!startsWithWindowsDriveLetter(this.input, this.pointer) &&\r\n          isNormalizedWindowsDriveLetterString(this.base.path[0])) {\r\n        this.url.path.push(this.base.path[0]);\r\n      }\r\n      this.url.host = this.base.host;\r\n    }\r\n    this.state = \"path\";\r\n    --this.pointer;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse file host\"] = function parseFileHost(c, cStr) {\r\n  if (isNaN(c) || c === p(\"/\") || c === p(\"\\\\\") || c === p(\"?\") || c === p(\"#\")) {\r\n    --this.pointer;\r\n    if (!this.stateOverride && isWindowsDriveLetterString(this.buffer)) {\r\n      this.parseError = true;\r\n      this.state = \"path\";\r\n    } else if (this.buffer === \"\") {\r\n      this.url.host = \"\";\r\n      if (this.stateOverride) {\r\n        return false;\r\n      }\r\n      this.state = \"path start\";\r\n    } else {\r\n      let host = parseHost(this.buffer, isNotSpecial(this.url));\r\n      if (host === failure) {\r\n        return failure;\r\n      }\r\n      if (host === \"localhost\") {\r\n        host = \"\";\r\n      }\r\n      this.url.host = host;\r\n\r\n      if (this.stateOverride) {\r\n        return false;\r\n      }\r\n\r\n      this.buffer = \"\";\r\n      this.state = \"path start\";\r\n    }\r\n  } else {\r\n    this.buffer += cStr;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse path start\"] = function parsePathStart(c) {\r\n  if (isSpecial(this.url)) {\r\n    if (c === p(\"\\\\\")) {\r\n      this.parseError = true;\r\n    }\r\n    this.state = \"path\";\r\n\r\n    if (c !== p(\"/\") && c !== p(\"\\\\\")) {\r\n      --this.pointer;\r\n    }\r\n  } else if (!this.stateOverride && c === p(\"?\")) {\r\n    this.url.query = \"\";\r\n    this.state = \"query\";\r\n  } else if (!this.stateOverride && c === p(\"#\")) {\r\n    this.url.fragment = \"\";\r\n    this.state = \"fragment\";\r\n  } else if (c !== undefined) {\r\n    this.state = \"path\";\r\n    if (c !== p(\"/\")) {\r\n      --this.pointer;\r\n    }\r\n  } else if (this.stateOverride && this.url.host === null) {\r\n    this.url.path.push(\"\");\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse path\"] = function parsePath(c) {\r\n  if (isNaN(c) || c === p(\"/\") || (isSpecial(this.url) && c === p(\"\\\\\")) ||\r\n      (!this.stateOverride && (c === p(\"?\") || c === p(\"#\")))) {\r\n    if (isSpecial(this.url) && c === p(\"\\\\\")) {\r\n      this.parseError = true;\r\n    }\r\n\r\n    if (isDoubleDot(this.buffer)) {\r\n      shortenPath(this.url);\r\n      if (c !== p(\"/\") && !(isSpecial(this.url) && c === p(\"\\\\\"))) {\r\n        this.url.path.push(\"\");\r\n      }\r\n    } else if (isSingleDot(this.buffer) && c !== p(\"/\") &&\r\n               !(isSpecial(this.url) && c === p(\"\\\\\"))) {\r\n      this.url.path.push(\"\");\r\n    } else if (!isSingleDot(this.buffer)) {\r\n      if (this.url.scheme === \"file\" && this.url.path.length === 0 && isWindowsDriveLetterString(this.buffer)) {\r\n        this.buffer = `${this.buffer[0]}:`;\r\n      }\r\n      this.url.path.push(this.buffer);\r\n    }\r\n    this.buffer = \"\";\r\n    if (c === p(\"?\")) {\r\n      this.url.query = \"\";\r\n      this.state = \"query\";\r\n    }\r\n    if (c === p(\"#\")) {\r\n      this.url.fragment = \"\";\r\n      this.state = \"fragment\";\r\n    }\r\n  } else {\r\n    // TODO: If c is not a URL code point and not \"%\", parse error.\r\n\r\n    if (c === p(\"%\") &&\r\n      (!infra.isASCIIHex(this.input[this.pointer + 1]) ||\r\n        !infra.isASCIIHex(this.input[this.pointer + 2]))) {\r\n      this.parseError = true;\r\n    }\r\n\r\n    this.buffer += utf8PercentEncodeCodePoint(c, isPathPercentEncode);\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse opaque path\"] = function parseOpaquePath(c) {\r\n  if (c === p(\"?\")) {\r\n    this.url.query = \"\";\r\n    this.state = \"query\";\r\n  } else if (c === p(\"#\")) {\r\n    this.url.fragment = \"\";\r\n    this.state = \"fragment\";\r\n  } else {\r\n    // TODO: Add: not a URL code point\r\n    if (!isNaN(c) && c !== p(\"%\")) {\r\n      this.parseError = true;\r\n    }\r\n\r\n    if (c === p(\"%\") &&\r\n        (!infra.isASCIIHex(this.input[this.pointer + 1]) ||\r\n         !infra.isASCIIHex(this.input[this.pointer + 2]))) {\r\n      this.parseError = true;\r\n    }\r\n\r\n    if (!isNaN(c)) {\r\n      this.url.path += utf8PercentEncodeCodePoint(c, isC0ControlPercentEncode);\r\n    }\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse query\"] = function parseQuery(c, cStr) {\r\n  if (!isSpecial(this.url) || this.url.scheme === \"ws\" || this.url.scheme === \"wss\") {\r\n    this.encodingOverride = \"utf-8\";\r\n  }\r\n\r\n  if ((!this.stateOverride && c === p(\"#\")) || isNaN(c)) {\r\n    const queryPercentEncodePredicate = isSpecial(this.url) ? isSpecialQueryPercentEncode : isQueryPercentEncode;\r\n    this.url.query += utf8PercentEncodeString(this.buffer, queryPercentEncodePredicate);\r\n\r\n    this.buffer = \"\";\r\n\r\n    if (c === p(\"#\")) {\r\n      this.url.fragment = \"\";\r\n      this.state = \"fragment\";\r\n    }\r\n  } else if (!isNaN(c)) {\r\n    // TODO: If c is not a URL code point and not \"%\", parse error.\r\n\r\n    if (c === p(\"%\") &&\r\n      (!infra.isASCIIHex(this.input[this.pointer + 1]) ||\r\n        !infra.isASCIIHex(this.input[this.pointer + 2]))) {\r\n      this.parseError = true;\r\n    }\r\n\r\n    this.buffer += cStr;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nURLStateMachine.prototype[\"parse fragment\"] = function parseFragment(c) {\r\n  if (!isNaN(c)) {\r\n    // TODO: If c is not a URL code point and not \"%\", parse error.\r\n    if (c === p(\"%\") &&\r\n      (!infra.isASCIIHex(this.input[this.pointer + 1]) ||\r\n        !infra.isASCIIHex(this.input[this.pointer + 2]))) {\r\n      this.parseError = true;\r\n    }\r\n\r\n    this.url.fragment += utf8PercentEncodeCodePoint(c, isFragmentPercentEncode);\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nfunction serializeURL(url, excludeFragment) {\r\n  let output = `${url.scheme}:`;\r\n  if (url.host !== null) {\r\n    output += \"//\";\r\n\r\n    if (url.username !== \"\" || url.password !== \"\") {\r\n      output += url.username;\r\n      if (url.password !== \"\") {\r\n        output += `:${url.password}`;\r\n      }\r\n      output += \"@\";\r\n    }\r\n\r\n    output += serializeHost(url.host);\r\n\r\n    if (url.port !== null) {\r\n      output += `:${url.port}`;\r\n    }\r\n  }\r\n\r\n  if (url.host === null && !hasAnOpaquePath(url) && url.path.length > 1 && url.path[0] === \"\") {\r\n    output += \"/.\";\r\n  }\r\n  output += serializePath(url);\r\n\r\n  if (url.query !== null) {\r\n    output += `?${url.query}`;\r\n  }\r\n\r\n  if (!excludeFragment && url.fragment !== null) {\r\n    output += `#${url.fragment}`;\r\n  }\r\n\r\n  return output;\r\n}\r\n\r\nfunction serializeOrigin(tuple) {\r\n  let result = `${tuple.scheme}://`;\r\n  result += serializeHost(tuple.host);\r\n\r\n  if (tuple.port !== null) {\r\n    result += `:${tuple.port}`;\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\nfunction serializePath(url) {\r\n  if (hasAnOpaquePath(url)) {\r\n    return url.path;\r\n  }\r\n\r\n  let output = \"\";\r\n  for (const segment of url.path) {\r\n    output += `/${segment}`;\r\n  }\r\n  return output;\r\n}\r\n\r\nmodule.exports.serializeURL = serializeURL;\r\n\r\nmodule.exports.serializePath = serializePath;\r\n\r\nmodule.exports.serializeURLOrigin = function (url) {\r\n  // https://url.spec.whatwg.org/#concept-url-origin\r\n  switch (url.scheme) {\r\n    case \"blob\":\r\n      try {\r\n        return module.exports.serializeURLOrigin(module.exports.parseURL(serializePath(url)));\r\n      } catch (e) {\r\n        // serializing an opaque origin returns \"null\"\r\n        return \"null\";\r\n      }\r\n    case \"ftp\":\r\n    case \"http\":\r\n    case \"https\":\r\n    case \"ws\":\r\n    case \"wss\":\r\n      return serializeOrigin({\r\n        scheme: url.scheme,\r\n        host: url.host,\r\n        port: url.port\r\n      });\r\n    case \"file\":\r\n      // The spec says:\r\n      // > Unfortunate as it is, this is left as an exercise to the reader. When in doubt, return a new opaque origin.\r\n      // Browsers tested so far:\r\n      // - Chrome says \"file://\", but treats file: URLs as cross-origin for most (all?) purposes; see e.g.\r\n      //   https://bugs.chromium.org/p/chromium/issues/detail?id=37586\r\n      // - Firefox says \"null\", but treats file: URLs as same-origin sometimes based on directory stuff; see\r\n      //   https://developer.mozilla.org/en-US/docs/Archive/Misc_top_level/Same-origin_policy_for_file:_URIs\r\n      return \"null\";\r\n    default:\r\n      // serializing an opaque origin returns \"null\"\r\n      return \"null\";\r\n  }\r\n};\r\n\r\nmodule.exports.basicURLParse = function (input, options) {\r\n  if (options === undefined) {\r\n    options = {};\r\n  }\r\n\r\n  const usm = new URLStateMachine(input, options.baseURL, options.encodingOverride, options.url, options.stateOverride);\r\n  if (usm.failure) {\r\n    return null;\r\n  }\r\n\r\n  return usm.url;\r\n};\r\n\r\nmodule.exports.setTheUsername = function (url, username) {\r\n  url.username = utf8PercentEncodeString(username, isUserinfoPercentEncode);\r\n};\r\n\r\nmodule.exports.setThePassword = function (url, password) {\r\n  url.password = utf8PercentEncodeString(password, isUserinfoPercentEncode);\r\n};\r\n\r\nmodule.exports.serializeHost = serializeHost;\r\n\r\nmodule.exports.cannotHaveAUsernamePasswordPort = cannotHaveAUsernamePasswordPort;\r\n\r\nmodule.exports.hasAnOpaquePath = hasAnOpaquePath;\r\n\r\nmodule.exports.serializeInteger = function (integer) {\r\n  return String(integer);\r\n};\r\n\r\nmodule.exports.parseURL = function (input, options) {\r\n  if (options === undefined) {\r\n    options = {};\r\n  }\r\n\r\n  // We don't handle blobs, so this just delegates:\r\n  return module.exports.basicURLParse(input, { baseURL: options.baseURL, encodingOverride: options.encodingOverride });\r\n};\r\n"]},"metadata":{},"sourceType":"script"}