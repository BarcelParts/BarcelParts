{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.validateSocksClientChainOptions = exports.validateSocksClientOptions = void 0;\n\nconst util_1 = require(\"./util\");\n\nconst constants_1 = require(\"./constants\");\n\nconst stream = require(\"stream\");\n/**\n * Validates the provided SocksClientOptions\n * @param options { SocksClientOptions }\n * @param acceptedCommands { string[] } A list of accepted SocksProxy commands.\n */\n\n\nfunction validateSocksClientOptions(options) {\n  let acceptedCommands = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : ['connect', 'bind', 'associate'];\n\n  // Check SOCKs command option.\n  if (!constants_1.SocksCommand[options.command]) {\n    throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksCommand, options);\n  } // Check SocksCommand for acceptable command.\n\n\n  if (acceptedCommands.indexOf(options.command) === -1) {\n    throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksCommandForOperation, options);\n  } // Check destination\n\n\n  if (!isValidSocksRemoteHost(options.destination)) {\n    throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsDestination, options);\n  } // Check SOCKS proxy to use\n\n\n  if (!isValidSocksProxy(options.proxy)) {\n    throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsProxy, options);\n  } // Validate custom auth (if set)\n\n\n  validateCustomProxyAuth(options.proxy, options); // Check timeout\n\n  if (options.timeout && !isValidTimeoutValue(options.timeout)) {\n    throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsTimeout, options);\n  } // Check existing_socket (if provided)\n\n\n  if (options.existing_socket && !(options.existing_socket instanceof stream.Duplex)) {\n    throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsExistingSocket, options);\n  }\n}\n\nexports.validateSocksClientOptions = validateSocksClientOptions;\n/**\n * Validates the SocksClientChainOptions\n * @param options { SocksClientChainOptions }\n */\n\nfunction validateSocksClientChainOptions(options) {\n  // Only connect is supported when chaining.\n  if (options.command !== 'connect') {\n    throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksCommandChain, options);\n  } // Check destination\n\n\n  if (!isValidSocksRemoteHost(options.destination)) {\n    throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsDestination, options);\n  } // Validate proxies (length)\n\n\n  if (!(options.proxies && Array.isArray(options.proxies) && options.proxies.length >= 2)) {\n    throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsProxiesLength, options);\n  } // Validate proxies\n\n\n  options.proxies.forEach(proxy => {\n    if (!isValidSocksProxy(proxy)) {\n      throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsProxy, options);\n    } // Validate custom auth (if set)\n\n\n    validateCustomProxyAuth(proxy, options);\n  }); // Check timeout\n\n  if (options.timeout && !isValidTimeoutValue(options.timeout)) {\n    throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsTimeout, options);\n  }\n}\n\nexports.validateSocksClientChainOptions = validateSocksClientChainOptions;\n\nfunction validateCustomProxyAuth(proxy, options) {\n  if (proxy.custom_auth_method !== undefined) {\n    // Invalid auth method range\n    if (proxy.custom_auth_method < constants_1.SOCKS5_CUSTOM_AUTH_START || proxy.custom_auth_method > constants_1.SOCKS5_CUSTOM_AUTH_END) {\n      throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsCustomAuthRange, options);\n    } // Missing custom_auth_request_handler\n\n\n    if (proxy.custom_auth_request_handler === undefined || typeof proxy.custom_auth_request_handler !== 'function') {\n      throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsCustomAuthOptions, options);\n    } // Missing custom_auth_response_size\n\n\n    if (proxy.custom_auth_response_size === undefined) {\n      throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsCustomAuthOptions, options);\n    } // Missing/invalid custom_auth_response_handler\n\n\n    if (proxy.custom_auth_response_handler === undefined || typeof proxy.custom_auth_response_handler !== 'function') {\n      throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsCustomAuthOptions, options);\n    }\n  }\n}\n/**\n * Validates a SocksRemoteHost\n * @param remoteHost { SocksRemoteHost }\n */\n\n\nfunction isValidSocksRemoteHost(remoteHost) {\n  return remoteHost && typeof remoteHost.host === 'string' && typeof remoteHost.port === 'number' && remoteHost.port >= 0 && remoteHost.port <= 65535;\n}\n/**\n * Validates a SocksProxy\n * @param proxy { SocksProxy }\n */\n\n\nfunction isValidSocksProxy(proxy) {\n  return proxy && (typeof proxy.host === 'string' || typeof proxy.ipaddress === 'string') && typeof proxy.port === 'number' && proxy.port >= 0 && proxy.port <= 65535 && (proxy.type === 4 || proxy.type === 5);\n}\n/**\n * Validates a timeout value.\n * @param value { Number }\n */\n\n\nfunction isValidTimeoutValue(value) {\n  return typeof value === 'number' && value > 0;\n}","map":{"version":3,"mappings":"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","names":["validateSocksClientOptions","options","acceptedCommands","constants_1","command","util_1","InvalidSocksCommand","indexOf","InvalidSocksCommandForOperation","isValidSocksRemoteHost","destination","InvalidSocksClientOptionsDestination","isValidSocksProxy","proxy","InvalidSocksClientOptionsProxy","validateCustomProxyAuth","timeout","isValidTimeoutValue","InvalidSocksClientOptionsTimeout","existing_socket","stream","Duplex","InvalidSocksClientOptionsExistingSocket","exports","validateSocksClientChainOptions","InvalidSocksCommandChain","proxies","Array","isArray","length","InvalidSocksClientOptionsProxiesLength","forEach","custom_auth_method","undefined","InvalidSocksClientOptionsCustomAuthRange","custom_auth_request_handler","InvalidSocksClientOptionsCustomAuthOptions","custom_auth_response_size","custom_auth_response_handler","remoteHost","host","port","ipaddress","type","value"],"sources":["../../src/common/helpers.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}